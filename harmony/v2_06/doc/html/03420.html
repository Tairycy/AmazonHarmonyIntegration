<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Running the Demonstration</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03437.html">usb_smart_speaker</a> &gt; <a href="03420.html">Running the Demonstration</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="03439.html">Previous</a> | <a href="03437.html">Up</a> | <a href="03440.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usa_smart_speaker_run Topic Title: Running the Demonstration)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Running the Demonstration</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Important!</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
Prior to using this demonstration, it is recommended to review the MPLAB Harmony Release Notes for any known issues. A PDF copy of the release notes is provided in the <i>&lt;install-dir&gt;/doc</i> folder of your installation.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
Compile and program the target device. While compiling, select the appropriate MPLAB X IDE project configuration based on the demonstration board. These configurations set the target processor, and the board and the Codec to be used in the output interface. Refer to <a href="03438.html">Building the Application</a> for details.&nbsp;</p>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
Do the following to run the demonstration:</p>
<ol class="Element630">
<li value="1" class="Element600">Power up the board and connect the programmer. Compile the application, program the target device, and run it. After the program starts, the name of the application should appear on the display, as shown in the following figure.</li>
</ol><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_smart_speaker pic32audio dac.png" border="0" alt="" title=""></p><p class="Element10">
&nbsp;</p>

<ol class="Element630">
<li value="2" class="Element600">The MEB II has an on-board AK4953 Codec. An external microphone connected to the &quot;MIC <a href="13954.html">IN</a>&quot; jack and loudspeaker, which is connected to the &quot;HP <a href="17338.html">OUT</a>&quot; jack is required, as shown. For demonstration purposes align the loudspeaker to the microphone so it can receive the echo to train the adaptive filter.</li>
<li value="3" class="Element600">Connect the board using the USB mini-B connector (for the <a href="04979.html">PIC32 Bluetooth Audio Development Kit</a> or to the mini-micro connector on the starter kit) to the Host computer with a standard USB cable.</li>
<li value="4" class="Element600">Allow the Host computer to acknowledge, install drivers (if needed), and enumerate the device. No special software is necessary on the Host side.</li>
<li value="5" class="Element600">If needed, configure the Host computer to use the usb_microphone as the selected audio recording device and playback device. For Windows, this is done in the &quot;Recording&quot; and &quot;Playback&quot; tabs in the &quot;Sound&quot; dialog accessed by right clicking the loudspeaker icon in the taskbar, as shown in the following figure.</li>
</ol><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_smart_speaker_soundDialog4.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
The device <i>Harmony USB Smart Speaker Example</i> should be available along with a sound level meter indicating audio input when touching the microphone. If no sound level is registering, uninstall the driver and reboot the Host computer, since it may have incorrect configuration set by a similar connection to one of the other MPLAB-X Harmony Audio Demostrations.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
&nbsp;</p>
<div class="Element15">
Initial AEC Training (ST Training Test)</div>

<ol class="Element630">
<li value="1" class="Element600">Audacity is used as the playback and record application on the PC. This is freely available and works well with this demonstration, although other playback and record applications will work also. Typically a smart speaker will initiate a training signal before general playback, such as the <span class="Element146">WN_p25_30Sec.wav</span> white noise file available in the <i>usb_smart_speaker/Audio</i> folder. This can be played initially to pretrain the AEC. After that any audio can be played if the speaker is not moved, and nothing has changed the echo path. Using Audacity to train the AEC requires the following:
<ul class="Element631">
<li class="Element601">Audacity must be set up in overdub mode. Therefore, playback occurs at the same time as record.</li>
<li class="Element601">The record button must be used (Playback can be used to listen to the recording after muting the training signal track in audacity). This will initiate playback at the same time as record when in overdub mode.</li>
</ul></li>
</ol><p class="Element10">
The initial training recording will show the echo gradually reduced to the background noise level, as shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_smart_speaker_Echo5.png" border="0" alt="" title=""></p>
<ol class="Element630">
<li value="2" class="Element600">The Echo Return Loss (ERL) and Echo Return Loss Enhancement (ERLE) can be measured by making a recording without echo cancellation using the <a href="03421.html">usb_headset demo</a> with the same setup, and comparing the recording to the recording in step 1. ERL gives the power lost from the echo reference signal through the loudspeaker, to the signal received by the AEC from the microphone. The ERLE provides further echo power reduction through the AEC.</li>
</ol><p class="Element10">
&nbsp;</p>
<div class="Element15">
Echo Cancellation while Playing Music (DT Echo Cancellation Test)</div>

<ol class="Element630">
<li value="1" class="Element600">The recording of near speech without echo is demonstrated by repeating the training setup with the following differences:
<ul class="Element631">
<li class="Element601">The playback file can be any audio file (preferably continuous audio)</li>
<li class="Element601">After hitting the record button, speak into the microphone a test sequence. Typically this is a number sequence, or the ABCâ€™s, which will allow you to know what is supposed to be heard. However, any speech is allowed.</li>
</ul></li>
<li value="2" class="Element600">The recording should only have echo residual plus the near microphone speech, as shown in the following figure.</li>
</ol><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usb_smart_speaker_convergence6 (002).png" border="0" alt="" title=""></p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03437.html">usb_smart_speaker</a> &gt; <a href="03420.html">Running the Demonstration</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usa_smart_speaker_run Topic Title: Running the Demonstration)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>