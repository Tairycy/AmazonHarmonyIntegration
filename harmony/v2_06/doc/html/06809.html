<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>How the Library Works</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="06802.html">Class B Library Help</a> &gt; <a href="06813.html">Using the Library</a> &gt; <a href="06809.html">How the Library Works</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="06812.html">Previous</a> | <a href="06813.html">Up</a> | <a href="06806.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: CLASSB How the Library Works Topic Title: How the Library Works)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
How the Library Works</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<div class="Element15">
CPU Register Test</div>
<p class="Element10">
<span style="color: #000000">The CPU Register test implements functional test <a href="13056.html">H</a>.2.16.5, as defined by the IEC 60730 standard. It detects stuck-at Faults in the CPU registers. This ensures that the bits in the registers are not stuck at a value of ‘0’ or ‘1’.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The CPU Register test is a non-destructive test. It performs the following major tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">The CPU registers and ghost registers are tested by first successively writing the binary sequences (length is dependent upon architecture), 010101... followed by 101010... into the registers, and then reading the values from these registers for verification.</span></li>
<li class="Element605"><span style="color: #000000">The test returns an error code if the returned values do not match.</span></li>
</ul></p><div class="Element15">
Program Counter Test</div>
<p class="Element10">
<span style="color: #000000">The Program Counter (PC) test implements the functional test <a href="13056.html">H</a>.2.16.5 defined by the IEC 60730 standard. It detects stuck-at Faults in the PC. The PC holds the address of the next instruction to be executed. The test performs the following major tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">Sets the error flag to the number of functions to be called.</span></li>
<li class="Element605"><span style="color: #000000">Calls the functions that are located in the Flash memory at different addresses chosen to alternate as many bits as possible in the PC.</span></li>
<li class="Element605"><span style="color: #000000">Each of these functions modifies the error flag.</span></li>
<li class="Element605"><span style="color: #000000">The error flag is tested after all functions are called.</span></li>
<li class="Element605"><span style="color: #000000">If the error flag is cleared, the PC has branched to all the correct locations.</span></li>
</ul></p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
The size of the program memory varies by device. Thus the addresses used to test the PC will vary in order to test as many PC bits as possible. Refer to the specific device data sheet for more details.&nbsp;</div></td></tr></table></div></div>
<div class="Element15">
Variable Memory Test</div>
<p class="Element10">
<span style="color: #000000">The Variable Memory test implements the Periodic Static Memory test <a href="13056.html">H</a>.2.19.6 defined by the IEC 60730 standard. It detects single bit Faults in variable memory. The variable memory contains data, which is intended to vary during program execution. The RAM Memory test is used to determine if any bit of the RAM memory is stuck at ‘1’ or ‘0’. The March Memory test and Checkerboard test are some of the widely used static memory algorithms for checking the DC Faults. The following tests can be implemented using the Class B Safety Software Library:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">Checkerboard</span></li>
<li class="Element605"><span style="color: #000000">March C/C- Test</span></li>
<li class="Element605"><span style="color: #000000">March B Test</span></li>
<li class="Element605"><span style="color: #000000">March C Stack test</span></li>
</ul></p><div class="Element15">
March Tests</div>
<p class="Element10">
<span style="color: #000000">A March test performs a finite set of operations on every memory cell in a memory array. Each operation performs the following tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">Writes ‘0’ to a memory cell (w0).</span></li>
<li class="Element605"><span style="color: #000000">Writes ‘1’ to a memory cell (w1).</span></li>
<li class="Element605"><span style="color: #000000">Reads the expected value ‘0’ from a memory cell (r0).</span></li>
<li class="Element605"><span style="color: #000000">Reads the expected value ‘1’ from a memory cell (r1).</span></li>
</ul><span style="color: #000000"><strong>March Test Notations</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">&gt; Arrange Addresses in ascending order</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">&lt; Arrange Addresses in descending order</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">&lt;&gt; Arrange Addresses in either order</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">r0 Indicates a read operation (Read ‘0’ from a memory cell)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">r1 Indicates a read operation (Read ‘0’ from a memory cell)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">w0 Indicates a write operation (Write ‘0’ to a memory cell)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">w1 Indicates a write operation (Write ‘1’ to a memory cell)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>MARCH C/C- TEST</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The March C/C- test is used to detect the following types of Fault in the variable memory:</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">• Stuck-at Fault</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">• Addressing Fault</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">• Transition Fault</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">• Coupling Fault</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The complexity of the March C/C- test is 11n and 10n respectively, where n indicates the number of bits in the memory. This test can be run as either destructive or non-destructive. If run in non- destructive mode buffer space is required to store the contents of the memory to be tested and restored. If needed, this test can be executed at the system start-up before initializing the memory.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>March C Algorithm</strong></span> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00190');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00190"><pre class="Element12">{
 &lt;&gt; (w0); &gt; (r0, w1); &gt; (r1, w0);
 &lt;&gt; (r0); &lt; (r0, w1); &lt; (r1, w0); &gt; (r0)
}</pre></div></div>
<p class="Element10">
<span style="color: #000000">Note1: is be removed for C-</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>MARCH B Test</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The March B is a non -redundant test that can detect the following types of Fault:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">Stuck-at</span></li>
<li class="Element605"><span style="color: #000000">Linked Idempotent Coupling</span></li>
<li class="Element605"><span style="color: #000000">Inversion Coupling</span></li>
</ul><span style="color: #000000">This test is of complexity 17n, where n indicates the number of bits in the memory. This test can be run as either destructive or non-destructive. If run in non-destructive mode buffer space is required to store the contents of the memory to be tested and restored. If needed, this test can be executed at the system start-up before initializing the memory.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>MARCH B ALGORITHM</strong></span> </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00191');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00191"><pre class="Element12">{
&lt;&gt; (w0); &gt; (r0, w1, r1, w0, r0, w1); &gt; (r1, w0, w1);
 &lt; (r1, w0, w1, w0); &lt; (r0, w1, w0);
}</pre></div></div>
<div class="Element15">
Checkerboard RAM Test</div>
<p class="Element10">
<span style="color: #000000">The Checkerboard RAM test writes the checkerboard patterns to a sequence of adjacent memory locations. This test is performed in units (memory chunks) of 8 bytes. This test can be run as either destructive or non-destructive. If run in non-destructive mode buffer space is required to store the contents of the memory to be tested and restored. If needed, this test can be executed at the system start-up before initializing the memory. This test performs the following major tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">Saves the contents of the memory locations to be tested in the buffer defined by bufferAddress.</span></li>
<li class="Element605"><span style="color: #000000">Writes the binary value (length is dependent upon architecture) 101010... to the memory location, ‘N’, and the inverted binary value, 010101..., to the memory location, ‘N+1’, and so on, until the whole memory chunk is filled.</span></li>
<li class="Element605"><span style="color: #000000">Reads the contents of all the memory locations in the current chunk and verifies its contents. If the values match, the function continues; otherwise it stops and returns an error.</span></li>
<li class="Element605"><span style="color: #000000">Step 2 and 3 are repeated by writing the inverted pattern to the same locations.</span></li>
<li class="Element605"><span style="color: #000000">Once a memory chunk is completed the test of the next chunk is started until all of the requested memory area is tested.</span></li>
</ul></p><div class="Element15">
Invariable Memory (Flash/EEPROM) Test</div>
<p class="Element10">
<span style="color: #000000">The Invariable Memory (Flash/EEPROM) test implements the periodic modified checksum <a href="13056.html">H</a>.2.19.3.1 defined by the IEC 60730 standard. It detects the single bit Faults in the invariable memory. The invariable memory in a system, such as Flash and EEPROM memory, contains data that is not intended to change during the program execution. The Flash/EEPROM Invariable Memory test computes the periodic check-sum using the Cyclic Redundancy Check (CRC-16). The CRC polynomial used to calculate the CRC-16 is shown below.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">CRC-16 = 1 1000 0000 0000 0101 = 8005 (hex)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The CRC functions can be used to test the integrity of data stored in either Flash or EEPROM memory. This is done by calculating and returning the CRC value of the data stored in the location defined in the function call.</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">If CRC_Flag is set to 0x00 at system start-up, the reference CRC checksum is computed.</span></li>
<li class="Element605"><span style="color: #000000">The reference checksum is stored in the Flash or EEPROM memory and the CRC flag is set to 0xFF.</span></li>
<li class="Element605"><span style="color: #000000">The CRC16 calculation function can be called periodically if the CRC flag is set to 0xFF.</span></li>
<li class="Element605"><span style="color: #000000">The checksum calculated from step 3 is compared with the reference checksum.</span></li>
<li class="Element605"><span style="color: #000000">If both values match, a status bit can be set by the user application to indicate that the invariable memory has passed the test and no errors were found.</span></li>
</ul></p><p class="Element10" style="text-align: center;">
<span style="color: #000000"><strong>Invariable Memory Test TEST Flowchart</strong></span>&nbsp;</p>
<p class="Element10" style="text-align: center;">
<img src="Flowchart for Invariable Memory Test.png" border="0" alt="" title=""></p><p class="Element10">
<span style="color: #000000">Note: Other than the calls to <a href="06819.html">CLASSB_CRCFlashTest</a> and CLASSB_CRCEEPROMTest, all steps in this flowchart are to be executed by the application firmware.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>Clock Test</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">According to the IEC 60730 standard, only harmonics and sub-harmonics of the clock need to be tested if using a quartz synchronized clock. The Clock test implements frequency monitoring <a href="13056.html">H</a>.2.18.10.1 as defined by the IEC 60730 standard. It verifies the reliability of the system clock (i.e., the system clock should be neither too fast nor too slow). The Clock Test function is used to verify the proper operation of the CPU clock. This test performs the following major tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">The independent clock source (Sosc or T1OSC) is required for the test. The reference clock should be connected to a timer such as Timer1.</span></li>
<li class="Element605"><span style="color: #000000">During the test the number of CPU clock cycles each reference clock period is counted.</span></li>
<li class="Element605"><span style="color: #000000">If the number of clock cycles is outside a specified range, the function returns an error code.</span></li>
</ul><span style="color: #000000"><strong>Clock Test Using Line Frequency</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The Clock Test function is used to verify the proper operation of the CPU clock. The 50 Hz/60 Hz line frequency is used as an independent clock source or a reference clock source. The input capture module is used for the period measurement. The 50 Hz/60 Hz line frequency is fed to the Input Capture pin (IC1) of the respective device. This test performs the following major tasks:</span>
<ul class="Element635">
<li class="Element605"><span style="color: #000000">The IC1 input is used as the independent clock source/reference clock source to capture the hardware Timer2. An external reference frequency, usually the line frequency, has to be applied to the IC1 input pin.</span></li>
<li class="Element605"><span style="color: #000000">The Input Capture 1 is configured as follows:</span>
<ul class="Element636">
<li class="Element606"><span style="color: #000000">Timer2 is selected as IC1 time base</span></li>
<li class="Element606"><span style="color: #000000">Capture is performed on every rising edge</span></li>
<li class="Element606"><span style="color: #000000">Capture done event is generated on every second capture.</span></li>
</ul></li>
<li class="Element605"><span style="color: #000000">The hardware Timer2 prescaler is calculated (based on the input reference frequency and the current PB frequency) as being the smallest divider possible such that the 16 bit Timer2 does not overflow within a period time of the input reference signal. This way, the best resolution is achieved for the given conditions. If no valid pre-scaler value can be obtained an error value is returned.</span></li>
<li class="Element605"><span style="color: #000000">The IC1 performs the capture on every rising edge of the input reference frequency. For period measurement, the capture done event is generated after the IC1 module takes two time stamps i.e. after every period of the input reference (20 ms if reference frequency is 50 Hz, 16.66ms if the reference frequency is 60 Hz).</span></li>
<li class="Element605"><span style="color: #000000">Once the capture done event is signaled, the two Timer2 captured readings are extracted and the number of elapsed PB clocks is calculated as being the difference between the two readings. If this value crosses the defined boundary limits the function returns an appropriate error value</span></li>
</ul><span style="color: #000000"><strong>Calculation Example 1:</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">System Clock = 80 MHz</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">PB Clock = 80 MHz (PB divider =1:1)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">Input Reference = 50 Hz</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">T2 Min Divider = floor(PBclk/(65536*RefClk))+1 = 25</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">Actual T2 Divider = 32.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The number of cycles counted in the Reference clock period is = (80,000,000/32)/50 = 50,000.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>Calculation Example 2:</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">System Clock = 80 MHz</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">PB Clock = 10 MHz (PB divider =1:8)</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">Input Reference = 60 Hz</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">T2 Min Divider = floor(PBclk/(65536*RefClk))+1 = 3</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">Actual T2 Divider = 4.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The number of cycles counted in the Reference clock period is = (10,000,000/4)/60 = 41,666.</span></p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="06802.html">Class B Library Help</a> &gt; <a href="06813.html">Using the Library</a> &gt; <a href="06809.html">How the Library Works</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: CLASSB How the Library Works Topic Title: How the Library Works)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>