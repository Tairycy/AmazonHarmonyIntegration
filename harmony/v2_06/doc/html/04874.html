<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Considerations While Moving the Application Image</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="04884.html">Bootloader Library Help</a> &gt; <a href="04889.html">Using the Library</a> &gt; <a href="04882.html">How the Library Works</a> &gt; <a href="04874.html">Considerations While Moving the Application Image</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="04880.html">Previous</a> | <a href="04882.html">Up</a> | <a href="04868.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: BOOTLOADER Considerations While Moving the Application Image Topic Title: Considerations While Moving the Application Image)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Considerations While Moving the Application Image</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
This section describes the procedure to place a user application into a desired program Flash memory region. It must be ensured that the user application’s memory region does not overlap with the memory region reserved for the Bootloader.&nbsp;</p>
<p class="Element10">
The Bootloader generated by MHC should be considered a starting point for your product’s Bootloader. As such, adding new features may cause the Bootloader to exceed the size intended in the Bootloader linker script. In addition, the Bootloaders provided in the <span class="Element146">apps/bootloader/basic</span> folder are configured to the <span class="Element146">–O1</span> compiler optimization. It is not the smallest possible size for the Bootloader, and turning on the <span class="Element146">–Os</span> or MIPS16/microMIPS code options will reduce the size of the Bootloader.&nbsp;</p>
<p class="Element10">
If the size of the Bootloader changes, the following steps should be performed to adjust both the Bootloader and the application in order to make sure that both fit and make best use of the device memory.
<ol class="Element635">
<li value="1" class="Element605">Determine the new ending address in Program Flash for the Bootloader. This can be done by using either the <span class="Element146">.map</span> file generated by MPLAB X IDE with the respective Compiler, or by using the ELFViewer plug-in for MPLAB X IDE.</li>
<li value="2" class="Element605">Round the address up to the nearest page boundary. For devices with 1K page sizes, the address must end on a 0x400 boundary. For devices with 4K page sizes, the address must end on a 0x1000 boundary.</li>
<li value="3" class="Element605">Within the <span style="color: #000000">Bootloader</span>, change the following files:
<ul class="Element636">
<li class="Element606">In <span class="Element146">btx_mx.ld</span> for PIC32MX devices, change the length of kseg0_program_mem to the new boundary</li>
<li class="Element606">in <span class="Element146">btl_cz.ld</span> for PIC32 C devices, change the Flash memory region LENGTH value to the new boundary</li>
</ul></li>
<li value="4" class="Element605">In system_config.h, change the value for APP_FLASH_BASE_ADDRESS to match the virtual address determined previously</li>
<li value="5" class="Element605">Within the application, change the linker script, <span class="Element146">app_mx.ld</span>, as follows:
<ul class="Element636">
<li class="Element606">Change _ebase_address to the new boundary, plus enough pages to get the exceptions to start at an address on a 4K (0x1000) boundary. This is to align it on the boundary required by the MIPS core.</li>
<li class="Element606">Change _RESET_ADDR to the new boundary previously determined</li>
<li class="Element606">Change the ORIGIN value for kseg0_program_mem to the new boundary</li>
</ul></li>
<li value="6" class="Element605">Recompile both the Bootloader and the application, as well as test operations.</li>
</ol>For PIC32MZ devices, any of the <span style="color: #000000">Bootloader</span>s can fit entirely into Boot Flash, although some currently take advantage of both panels of Boot Flash. This is done by making the two Boot Flash memories appear as one panel in the linker script, but using a fill command to the linker to block out the area that is not available. When the resulting file is loaded by MPLAB X IDE, you may receive the following warning:&nbsp;</p>
<p class="Element10">
<i>Warning: C:/microchip/harmony/core/apps/bootloader/basic/firmware/basic.X/dist/udp_pic32mz_ef_sk/production/basic.X.production.hex contains code that is located at addresses that do not exist on the PIC32MZxxx.</i>&nbsp;</p>
<p class="Element10">
This warning can be ignored, as it is a warning about the fill memory. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Notes:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">

<ol class="Element635">
<li value="1" class="Element605">For more information on PIC32M linker script memory regions, refer to the <i>“MPLAB® XC32 Assembler, Linker and Utilities User’s Guide”</i> (DS50002186) and the <i>“MPLAB® XC32 C/C++ Compiler User’s Guide”</i> (DS50001686).</li>
</ol>&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="04884.html">Bootloader Library Help</a> &gt; <a href="04889.html">Using the Library</a> &gt; <a href="04882.html">How the Library Works</a> &gt; <a href="04874.html">Considerations While Moving the Application Image</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: BOOTLOADER Considerations While Moving the Application Image Topic Title: Considerations While Moving the Application Image)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>