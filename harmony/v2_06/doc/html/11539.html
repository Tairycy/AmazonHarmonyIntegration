<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>DRV_USBFS_DEVICE_IRPCancel Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="13069.html">Driver Libraries Help</a> &gt; <a href="28590.html">USB Driver Libraries</a> &gt; <a href="08935.html">PIC32MX USB Driver</a> &gt; <a href="08931.html">Library Interface</a> &gt; c) Device Mode Operation Functions &gt; <a href="11539.html">DRV_USBFS_DEVICE_IRPCancel Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="11537.html">Previous</a> | <a href="08931.html">Up</a> | <a href="11540.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_USBFS_DEVICE_IRPCancel@DRV_HANDLE@USB_DEVICE_IRP * Topic Title: DRV_USBFS_DEVICE_IRPCancel Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
DRV_USBFS_DEVICE_IRPCancel Function</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="43"></a><div class="Element99">
C</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><a href="27941.html">USB_ERROR</a> <strong><span style="color: #000000">DRV_USBFS_DEVICE_IRPCancel</span></strong>(
    <a href="10088.html">DRV_HANDLE</a> <strong><span style="color: #000000">client</span></strong>, 
    <a href="27843.html">USB_DEVICE_IRP</a> * <strong><span style="color: #000000">irp</span></strong>
);</pre></div></div>
<a name="4465736372697074696F6E"></a><div class="Element14">
Description</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
This function attempts to cancel the processing of a queued IRP. An IRP that was in the queue but yet to be processed will be cancelled successfully and the IRP callback function will be called from this function with the USB_DEVICE_IRP_STATUS_ABORTED status. The application can release the data buffer memory used by the IRP when this callback occurs. If the IRP was in progress (a transaction in on the bus) when the cancel function was called, the IRP will be canceled only when an ongoing or the next transaction has completed. The IRP callback function will then be called in an interrupt context. The application should not release the related data buffer unless the IRP callback has occurred.</p></div>
</div>
<a name="507265636F6E646974696F6E73"></a><div class="Element14">
Preconditions</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The Client handle should be valid.</p></div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
Parameters</div>
<div class="Element11">
<div class="Element10">
<div class="Element312">
<div class="TableDiv">
<table cellspacing="0" class="Table4">
<tr>
<td class="Element300" valign="top" width="35%">
<div class="Element301">
Parameters&nbsp;</div></td><td class="Element304" valign="top" width="65%">
<div class="Element305">
Description&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
handle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Client's driver handle (returned from <a href="11601.html">DRV_USBFS_Open</a> function).&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
irp&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
Pointer to the IRP to cancel.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
Returns</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">

<ul class="Element636">
<li class="Element606">USB_ERROR_NONE - The IRP have been canceled successfully.</li>
<li class="Element606">USB_ERROR_PARAMETER_INVALID - Invalid parameter or the IRP already has been aborted or completed</li>
<li class="Element606">USB_ERROR_OSAL_FUNCTION - An OSAL function called in this function did not execute successfully.</li>
</ul></p></div>
</div>
<a name="52656D61726B73"></a><div class="Element14">
Remarks</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The size returned after the ABORT callback will be always 0 regardless of the amount of data that has been sent or received. The client should not assume any data transaction has happened for an canceled IRP. If the last transaction of the IRP was in progress, the IRP cancel does not have any effect. The first transaction of any ongoing IRP cannot be canceled.</p></div>
</div>
<a name="4578616D706C65"></a><div class="Element14">
Example</div>
<div class="Element11">
<div class="Element10">
<div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code01106');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code01106"><pre class="Element12"><i><span style="color: #008000">// This code shows an example of how to cancel IRP.  In this example the IRP</span></i>
<i><span style="color: #008000">// has been scheduled from a device to the Host.</span></i>

<a href="27934.html">USB_ENDPOINT</a> ep;
<a href="27843.html">USB_DEVICE_IRP</a> irp;

ep.direction = <a href="27935.html">USB_ENDPOINT_AND_DIRECTION</a>(USB_DATA_DIRECTION_DEVICE_TO_HOST, 1);

irp.data = myDataBufferToSend;
irp.size = 130;
irp.flags = USB_DEVICE_IRP_FLAG_DATA_COMPLETE;
irp.callback = MyIRPCompletionCallback;
irp.referenceData = (uintptr_t)&amp;myDeviceLayerObj;

<strong><span style="color: #000080">if</span></strong> (<a href="11541.html">DRV_USBFS_DEVICE_IRPSubmit</a>(handle, ep, &amp;irp) != USB_ERROR_NONE)
{
    <i><span style="color: #008000">// This means there was an error.</span></i>
}
<strong><span style="color: #000080">else</span></strong>
{
    <i><span style="color: #008000">// Check the status of the IRP.</span></i>
    <strong><span style="color: #000080">if</span></strong>(irp.status != USB_DEVICE_IRP_STATUS_COMPLETED)
    {
        <i><span style="color: #008000">// Cancel the submitted IRP.</span></i>
        <strong><span style="color: #000080">if</span></strong> (DRV_USBFS_DEVICE_IRPCancel(handle, &amp;irp) != USB_ERROR_NONE)
        {
            <i><span style="color: #008000">// The IRP Cancel request submission was successful.</span></i>
            <i><span style="color: #008000">// IRP cancel status will be notified through the callback</span></i>
            <i><span style="color: #008000">// function.</span></i>
        }
        <strong><span style="color: #000080">else</span></strong>
        {
            <i><span style="color: #008000">// The IRP may have been completed before IRP cancel operation.</span></i>
            <i><span style="color: #008000">// could start. No callback notification will be generated.</span></i>
        }
    }
    <strong><span style="color: #000080">else</span></strong>
    {
        <i><span style="color: #008000">// The IRP processing must have been completed before IRP cancel was</span></i>
        <i><span style="color: #008000">// submitted.</span></i>
    }
}

<strong><span style="color: #000080">void</span></strong> MyIRPCallback(<a href="27843.html">USB_DEVICE_IRP</a> * irp)
{
    <i><span style="color: #008000">// Check if the IRP callback is for a Cancel request</span></i>
    <strong><span style="color: #000080">if</span></strong>(irp-&gt;status == USB_DEVICE_IRP_STATUS_ABORTED)
    {
        <i><span style="color: #008000">// IRP cancel completed</span></i>
    }
 }
</pre></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="13069.html">Driver Libraries Help</a> &gt; <a href="28590.html">USB Driver Libraries</a> &gt; <a href="08935.html">PIC32MX USB Driver</a> &gt; <a href="08931.html">Library Interface</a> &gt; c) Device Mode Operation Functions &gt; <a href="11539.html">DRV_USBFS_DEVICE_IRPCancel Function</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_USBFS_DEVICE_IRPCancel@DRV_HANDLE@USB_DEVICE_IRP * Topic Title: DRV_USBFS_DEVICE_IRPCancel Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>