<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Cache Control Operations</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="22294.html">Prefetch Cache Peripheral Library</a> &gt; <a href="17878.html">Using the Library</a> &gt; <a href="17870.html">How the Library Works</a> &gt; <a href="17858.html">Cache Control Operations</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="17870.html">Previous</a> | <a href="17870.html">Up</a> | <a href="17860.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB PCACHE Cache Control Operations Topic Title: Cache Control Operations)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Cache Control Operations</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
<strong>Cache Wait States</strong>&nbsp;</p>
<p class="Element10">
When operating at high clock rates, the Prefetch Cache module must insert wait states into Program Flash Memory (PFM) read operations to meet PFM access time requirements. One Wait state is equivalent to one clock cycle delay. At reset, the Prefetch Cache Module is set to the maximum number of wait states for the device. The PFM read time can be optimized for the device by selecting the minimum number of wait states for the clock rate used. The number of wait states for a given clock frequency may vary between devices. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
Refer to the specific device data sheet for details on how to calculate the optimum number of wait states for your device.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
<strong>Example: Setting the Number of PFM wait states based on the System Clock</strong>&nbsp;</p>
<p class="Element10">
This example assumes one wait state for every 20 MHz of system clock. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02991');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02991"><pre class="Element12"><strong><span style="color: #000080">if</span></strong> (sysclk &lt; 20000000)
{
 PLIB_PCACHE_WaitStateSet(0);
}
<strong><span style="color: #000080">else</span></strong> <strong><span style="color: #000080">if</span></strong> (sysclk &lt; 40000000)
{
 PLIB_PCACHE_WaitStateSet(1);
}
...</pre></div></div>
<p class="Element10">
<strong>Data Caching</strong>&nbsp;</p>
<p class="Element10">
Some Prefetch Cache modules allow the user to allocate cache lines to data. This is to provide improved CPU access to constant data stored in PFM. By default, data caching is disabled. The Prefetch Cache Peripheral Library allows the user to set the number of cache lines allocated to data. The number of lines available may vary among devices. The available settings are provided by the device-dependent <a href="20133.html">PLIB_PCACHE_DATA_ENABLE</a> enumeration.&nbsp;</p>
<p class="Element10">
<strong>Example: Allocating two Cache Lines to Data</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02992');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02992"><pre class="Element12">PLIB_PCACHE_DataCacheEnableSet(PLIB_PCACHE_DATA_2LINE);</pre></div></div>
<p class="Element10">
<strong>Cache Line Invalidating on PFM Write</strong>&nbsp;</p>
<p class="Element10">
It is not possible to execute out of cache while programming the PFM. The PFM controller stalls the cache during the programming sequence. Therefore, user code that initiates a programming sequence should not be located in a cacheable address region.&nbsp;</p>
<p class="Element10">
During program operation, the Prefetch Cache is flushed by invalidating some or all of the cache lines. To invalidate all of the cache lines on a PFM write operation, the function <a href="20175.html">PLIB_PCACHE_InvalidateOnPFMProgramAll</a> should be called prior to the PFM write. This will invalidate and unlock every cache line during the write operation. The cache tags and masks are also cleared for all lines.&nbsp;</p>
<p class="Element10">
If <a href="20176.html">PLIB_PCACHE_InvalidateOnPFMProgramUnlocked</a> is called before the PFM write, only lines that are not locked will be forced invalid.&nbsp;</p>
<p class="Element10">
By default, only unlocked cache lines are invalidated during a PFM write.</p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="22294.html">Prefetch Cache Peripheral Library</a> &gt; <a href="17878.html">Using the Library</a> &gt; <a href="17870.html">How the Library Works</a> &gt; <a href="17858.html">Cache Control Operations</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB PCACHE Cache Control Operations Topic Title: Cache Control Operations)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>