<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Operating as a Master Transmitter</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="13730.html">I2C Peripheral Library</a> &gt; <a href="17736.html">Using the Library</a> &gt; <a href="17718.html">How the Library Works</a> &gt; <a href="17727.html">Operating as a Master Transmitter</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="17729.html">Previous</a> | <a href="17718.html">Up</a> | <a href="17726.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB I2C Operating as a Master Transmitter Topic Title: Operating as a Master Transmitter)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Operating as a Master Transmitter</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
Whenever the I2C module initiates a transfer on the bus, it is acting as master. A transfer can be initiated any time the bus is idle. If two masters attempt to initiate transfers at nearly the same time, one of them will lose arbitration at some point during the transfer and must retry the transfer later when the bus becomes idle. The winner of arbitration can continue, without any data loss.&nbsp;</p>
<p class="Element10">
An I2C bus transfer always begins with a Start condition, followed by one or two properly formatted bytes containing the 7-bit or 10-bit target slave address (address of the slave device that is the target of the transfer). The direction of the remainder of transfers (after the address has been sent) is indicated by bit 0 of the address (0 = write/transmitting, 1 = read/receiving, from the point of view of the master). After that, any amount of data may be transferred and a repeated Start condition (followed by another properly formatted address) can occur to change the direction of the transfer or even the target slave device. See <a href="17713.html">Forming Transfers</a> for details of the possible transfer formats. When the master is finished, an I2C bus transfer always ends with a Stop condition. These steps are summarized as follows:&nbsp;</p>
<p class="Element10">
<strong>Summary of Steps</strong>
<ol class="Element630">
<li value="1" class="Element600">Send a Start condition.</li>
<li value="2" class="Element600">Send a 7-bit or 10-bit address (one or two bytes with a write transfer indication in bit 0).</li>
<li value="3" class="Element600">Send data bytes.</li>
<li value="4" class="Element600">Send a Stop condition.</li>
</ol>Each of these steps making up a transfer will take some time to complete. The completion of each step will cause an I2C master interrupt. The software must always keep track of which state it was in, check the I2C status, and respond to the interrupt by performing the next appropriate step. &nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Notes:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">

<ol class="Element630">
<li value="1" class="Element600">Arbitration loss can occur after each step has completed. Software should check for arbitration loss by calling the <a href="19530.html">PLIB_I2C_ArbitrationLossHasOccurred</a> function. If arbitration loss occurs, it must be cleared by calling the <a href="19529.html">PLIB_I2C_ArbitrationLossClear</a> function.</li>
<li value="2" class="Element600">After any step completes, but before sending the Stop condition (see step 4), the master may send a repeated Start condition and start over at step 2 to change slave targets and/or transfer direction.</li>
</ol>&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
<strong>Sending a Start Condition</strong>&nbsp;</p>
<p class="Element10">
To start a master transfer, the software must do the following:&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>&nbsp;</p>
<p class="Element10">
The module must have had its basic options and clock frequency initialized and have been enabled (see <a href="17719.html">Initializing the I2C</a>).&nbsp;</p>
<p class="Element10">
<strong>Process</strong>
<ol class="Element630">
<li value="1" class="Element600">Verify that the bus is idle using the <a href="19533.html">PLIB_I2C_BusIsIdle</a> function.</li>
<li value="2" class="Element600">Send the start signal using the <a href="19588.html">PLIB_I2C_MasterStart</a> function.</li>
<li value="3" class="Element600">Check for arbitration loss after the start condition has completed using the <a href="19530.html">PLIB_I2C_ArbitrationLossHasOccurred</a> function.</li>
</ol><strong>Example: Sending a Start Condition</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02479');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02479"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID  I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_BusIsIdle(MY_I2C_ID))
{
    PLIB_I2C_MasterStart(MY_I2C_ID);
}</pre></div></div>
<p class="Element10">
The Start condition must be allowed to complete before any additional steps can be taken. The only way to determine this is to wait for a master interrupt to occur after the Start condition has been initiated. Even if the bus is verified to be idle before sending the start condition, a bus collision can still occur while the Start condition is being transmitted. To verify that arbitration has not been lost during transmission of the Start condition, the software should check the <a href="19530.html">PLIB_I2C_ArbitrationLossHasOccurred</a> function after the Start condition has completed.&nbsp;</p>
<p class="Element10">
<strong>Example: Checking for Arbitration Loss</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02480');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02480"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID  I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_ArbitrationLossHasOccurred(MY_I2C_ID))
{
    <i><span style="color: #008000">// Abort transfer, retry later</span></i>

    PLIB_I2C_ArbitrationLossClear(MY_I2C_ID);
}</pre></div></div>
<p class="Element10">
<strong>Sending a 7-bit Address</strong>&nbsp;</p>
<p class="Element10">
To send a 7-bit address, the software must do the following:&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>&nbsp;</p>
<p class="Element10">
The Start condition must have been sent and completed as previously described.&nbsp;</p>
<p class="Element10">
<strong>Process</strong>
<ol class="Element630">
<li value="1" class="Element600">Write the address byte to the TX buffer using the <a href="19638.html">PLIB_I2C_TransmitterByteSend</a> function. The address byte that is supplied as the parameter to <a href="19638.html">PLIB_I2C_TransmitterByteSend</a> should also include the R/W bit.</li>
</ol>&nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
A master interrupt will occur once the address byte has been transmitted and ACKed or NAKed by the targeted slave device. (If the slave device does not answer, an implicit NAK will occur.)&nbsp;</div></td></tr></table></div></div>
<p class="Element10">

<ol class="Element630">
<li value="2" class="Element600">Once the address byte has been ACKed or NAKed by the slave target, software must verify the result and respond appropriately. The Acknowledgement and Arbitration process is described in a subsequent section, just before the description of how to send a Stop condition.)</li>
</ol><strong>Example: Sending a 7-bit Address</strong> </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02481');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02481"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1
<strong><span style="color: #000080">#define</span></strong> SLAVE_TARGET_ADDRESS 0x22
uint8_t slaveAddress = 0;

<i><span style="color: #008000">// Format the 7-bit address byte with the write indication in bit 0</span></i>
slaveAddress = SLAVE_TARGET_ADDRESS;

<i><span style="color: #008000">// Send the address byte</span></i>
<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterIsReady(MY_I2C_ID))
{
    PLIB_I2C_TransmitterByteSend(MY_I2C_ID, slaveAddress);
}</pre></div></div>
<div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
Bits 7-1 contain the 7-bit target slave address. Bit 0 indicates read or write direction for the remainder of the transfer.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
<strong>Sending a 10-bit Target Slave Address</strong>&nbsp;</p>
<p class="Element10">
To send a 10-bit address, the software must do the following:&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>&nbsp;</p>
<p class="Element10">
The Start condition must have been sent and completed as previously described.&nbsp;</p>
<p class="Element10">
<strong>Process</strong>
<ol class="Element630">
<li value="1" class="Element600">Format the two address bytes correctly with the 10-bit address and the read/write bit appropriately set (for a read transfer) or cleared (for a write transfer).</li>
<li value="2" class="Element600">Ensure that the TX buffer is currently ready to<span style="color: #FFFFFF">_</span>accept<span style="color: #FFFFFF">_</span>a byte to be transmitted using the <a href="19641.html">PLIB_I2C_TransmitterIsReady</a> function.</li>
<li value="3" class="Element600">Write the first address byte to the TX buffer using the <a href="19638.html">PLIB_I2C_TransmitterByteSend</a> function.</li>
</ol>&nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
After the first byte has been sent and ACKed or NAKed by the slave, a master interrupt will occur (or you can poll the <a href="19637.html">PLIB_I2C_TransmitterByteHasCompleted</a> function).&nbsp;</div></td></tr></table></div></div>
<p class="Element10">

<ol class="Element630">
<li value="4" class="Element600">Ensure that the first address byte was ACKed by the slave target (to do this, follow the Acknowledgement process described in a following section.</li>
<li value="5" class="Element600">Write the second address byte to the TX buffer using the <a href="19641.html">PLIB_I2C_TransmitterIsReady</a> function and the <a href="19638.html">PLIB_I2C_TransmitterByteSend</a> function.</li>
</ol></p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
After the second byte has been sent and ACKed or NAKed by the slave, a master interrupt will occur (or you can poll the <a href="19637.html">PLIB_I2C_TransmitterByteHasCompleted</a> function).&nbsp;</div></td></tr></table></div></div>
<p class="Element10">

<ol class="Element630">
<li value="6" class="Element600">Ensure that the second address byte was ACKed by the slave target (to do this, follow the process in the Acknowledgement and Arbitration, which is described later in this section).</li>
</ol><strong>Example: Formatting the 10-bit Address in Two Bytes</strong> </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02482');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02482"><pre class="Element12"><i><span style="color: #008000">/* first byte of 10-bit address which is inclusive of R/W bit */</span></i>
<strong><span style="color: #000080">#define</span></strong> SLAVE_TARGET_10BIT_ADDRESS_BYTE1 0xF6

<i><span style="color: #008000">/* second byte of 10-bit address */</span></i>
<strong><span style="color: #000080">#define</span></strong> SLAVE_TARGET_10BIT_ADDRESS_BYTE2 0x22

uint8_t slaveAddressByte1 = 0;
uint8_t slaveAddressByte2 = 0;

<i><span style="color: #008000">/* include the R/W in bit 0 of the first byte */</span></i>
slaveAddressByte1 = SLAVE_TARGET_10BIT_ADDRESS_BYTE1;
slaveAddressByte2 = SLAVE_TARGET_10BIT_ADDRESS_BYTE2;</pre></div></div>
<p class="Element10">
<strong>Example: Sending the First Byte of a 10-bit Address</strong> </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02483');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02483"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterIsReady(MY_I2C_ID))
{
    PLIB_I2C_TransmitterByteSend(MY_I2C_ID, slaveAddressByte1);
}</pre></div></div>
<p class="Element10">
Wait for transmission to complete and check for acknowledgement and/or arbitration loss.&nbsp;</p>
<p class="Element10">
<strong>Example: Sending the Second Byte of a 10-bit Address</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02484');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02484"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterIsReady(MY_I2C_ID))
{
    PLIB_I2C_TransmitterByteSend(MY_I2C_ID, slaveAddressByte2);
}</pre></div></div>
<p class="Element10">
Wait for transmission to complete and check for acknowledgement and/or arbitration loss.&nbsp;</p>
<p class="Element10">
<strong>Sending a Data Byte</strong>&nbsp;</p>
<p class="Element10">
The following sequence can be used to send a data byte and repeated to send an arbitrary number of data bytes.&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>
<ul class="Element630">
<li class="Element600">The Start condition must have been sent and completed as previously described</li>
<li class="Element600">The target slave address has been fully transmitted (with the write indication in bit 0) and ACKed by the targeted slave device</li>
</ul><strong>Process</strong>
<ol class="Element630">
<li value="1" class="Element600">Ensure that the TX buffer is currently ready to<span style="color: #FFFFFF">_</span>accept<span style="color: #FFFFFF">_</span>a byte to be transmitted using the <a href="19641.html">PLIB_I2C_TransmitterIsReady</a> Function.</li>
<li value="2" class="Element600">Write the byte to be transmitted to the TX buffer using the <a href="19638.html">PLIB_I2C_TransmitterByteSend</a> Function.</li>
</ol>&nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
After the byte has been sent and ACKed or NAKed by the slave, a master interrupt will occur (or poll the <a href="19637.html">PLIB_I2C_TransmitterByteHasCompleted</a> function).&nbsp;</div></td></tr></table></div></div>
<p class="Element10">

<ol class="Element630">
<li value="3" class="Element600">Check for arbitration loss or an ACK or NAK from the slave as described in the next section, Acknowledgement and Arbitration.</li>
</ol><strong>Example</strong> </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02485');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02485"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1
uint8_t         data;

<i><span style="color: #008000">// Assign the data value into the &quot;data&quot; variable</span></i>

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterIsReady(MY_I2C_ID))
{
    PLIB_I2C_TransmitterByteSend(MY_I2C_ID, data);
}</pre></div></div>
<p class="Element10">
Wait for transmission to complete and check for acknowledgement and/or arbitration loss.&nbsp;</p>
<p class="Element10">
<strong>Acknowledgement and Arbitration</strong>&nbsp;</p>
<p class="Element10">
After sending a data or address byte (as previously described), the master transmitter must check to see if arbitration was lost and if the byte was ACKed or NAKed. If the byte was ACKed, the slave receiver is ready to receive more bytes. If the byte was NAKed, the slave receiver cannot<span style="color: #FFFFFF">_</span>accept<span style="color: #FFFFFF">_</span>any more bytes at this time.&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>
<ul class="Element630">
<li class="Element600">The start condition must have been sent and completed as previously described</li>
<li class="Element600">A byte (address or data) must have been transmitted, using one of the previous processes</li>
</ul><strong>Process</strong>
<ol class="Element630">
<li value="1" class="Element600">Ensure that the byte has been completely transmitted using the <a href="19637.html">PLIB_I2C_TransmitterByteHasCompleted</a> function (and/or by waiting for the master interrupt)</li>
<li value="2" class="Element600">Determine if arbitration loss has occurred using the <a href="19530.html">PLIB_I2C_ArbitrationLossHasOccurred</a> function.</li>
<li value="3" class="Element600">Determine if the byte was ACKed or NAKed using the <a href="19639.html">PLIB_I2C_TransmitterByteWasAcknowledged</a> function.</li>
</ol><strong>Example</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02486');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02486"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterByteHasCompleted(MY_I2C_ID))
{
    <strong><span style="color: #000080">if</span></strong> (PLIB_I2C_ArbitrationLossHasOccurred(MY_I2C_ID))
    {
        <i><span style="color: #008000">// Handle arbitration loss</span></i>

        PLIB_I2C_ArbitrationLossClear(MY_I2C_ID);
    }
    <strong><span style="color: #000080">else</span></strong>
    {
        <strong><span style="color: #000080">if</span></strong> (PLIB_I2C_TransmitterByteWasAcknowledged(MY_I2C_ID))
        {
            <i><span style="color: #008000">// Transmission successful</span></i>
        }
        <strong><span style="color: #000080">else</span></strong>
        {
            <i><span style="color: #008000">// Transmission was not successful</span></i>
        }
    }
}</pre></div></div>
<p class="Element10">
To handle arbitration loss, the master transmitter must stop the transfer process and retry the entire transfer again at a later time when the bus is not busy.&nbsp;</p>
<p class="Element10">
<strong>Sending a Repeated Start Condition</strong>&nbsp;</p>
<p class="Element10">
If the master wants to change slave targets or transfer directions, it can send a repeated Start condition followed by a new address at any time after the previous target slave address has been acknowledged (and before the Stop condition has been sent).&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>
<ul class="Element630">
<li class="Element600">The Start condition must have been sent and completed as previously described</li>
<li class="Element600">A target slave address must have been transmitted and ACKed</li>
<li class="Element600">Zero or more data bytes may also have been sent and ACKed</li>
</ul><strong>Process</strong>&nbsp;</p>
<p class="Element10">
Send the repeated Start condition using the <a href="19589.html">PLIB_I2C_MasterStartRepeat</a> function.&nbsp;</p>
<p class="Element10">
<strong>Example</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02487');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02487"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

PLIB_I2C_MasterStartRepeat(MY_I2C_ID);</pre></div></div>
<p class="Element10">
The Start condition must be allowed to complete before any additional steps can be taken. The only way to determine this is to wait for a master interrupt to occur after the Start condition has been initiated.&nbsp;</p>
<p class="Element10">
The repeated Start must be followed by another target slave address (either 7-bit or 10-bit, as appropriate).&nbsp;</p>
<p class="Element10">
<strong>Sending a Stop Condition</strong>&nbsp;</p>
<p class="Element10">
When the master transmitter has finished sending data, it must end the transfer with a stop condition.&nbsp;</p>
<p class="Element10">
<strong>Preconditions</strong>
<ul class="Element630">
<li class="Element600">The Start condition must have been sent and completed as previously described</li>
<li class="Element600">A target slave address must have been transmitted and ACKed</li>
<li class="Element600">Zero or more data bytes may also have been sent and ACKed</li>
</ul>&nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
At least one address byte must be transmitted between the Start and Stop conditions. Following a Start condition immediately with a Stop condition is a protocol error and can cause some slave devices to lock up and stop responding to the bus.&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
<strong>Process</strong>&nbsp;</p>
<p class="Element10">
Send a stop condition using the <a href="19590.html">PLIB_I2C_MasterStop</a> function.&nbsp;</p>
<p class="Element10">
<strong>Example</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02488');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02488"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

PLIB_I2C_MasterStop(MY_I2C_ID);</pre></div></div>
<p class="Element10">
The Stop condition must be allowed to complete before any additional steps can be taken. The only way to determine this is to wait for a master interrupt to occur after the Stop condition has been initiated.&nbsp;</p>
<p class="Element10">
After a Stop condition, the bus should be idle unless a master immediately starts a new transfer. Strictly speaking, a bus collision can still occur while the Stop condition is being transmitted. Although the transfer is already completed when the Stop condition has been sent, software does not have to abort the transfer; however, it should still check for and clear the arbitration loss condition if it occurs.&nbsp;</p>
<p class="Element10">
<strong>Example: Checking for Arbitration Loss</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code02489');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code02489"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_I2C_ID I2C_ID_1

<strong><span style="color: #000080">if</span></strong> (PLIB_I2C_ArbitrationLossHasOccurred(MY_I2C_ID))
{
    PLIB_I2C_ArbitrationLossClear(MY_I2C_ID);
}</pre></div></div>
<p class="Element10">
The previous examples use the following constants and variables: </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="19%">
<div class="Element66">
Symbol&nbsp;</div></td><td class="Element65" valign="top" width="81%">
<div class="Element66">
Description&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">MY_I2C_ID</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
Defined as the selected I<sup>2</sup>C module value from the I2C Module enumeration. Example: <span class="Element146">#define MY_I2C_ID I2C_ID_1</span>&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">data</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
This is the buffer containing byte of data to transmit.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">slaveTargetAddress7Bit</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
This variable is used to demonstrate how to properly format and access a 7-bit target slave address&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">SLAVE_TARGET_7BIT_ADDRESS</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
This constant is used as a placeholder for the actual 7-bit target slave address that must be defined by the client code.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">slaveAddress10Bit</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
This variable is used to demonstrate how to properly format and access a 10-bit slave address.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="19%">
<div class="Element68">
<span class="Element146">SLAVE_TARGET_10BIT_ADDRESS</span>&nbsp;</div></td><td class="Element67" valign="top" width="81%">
<div class="Element68">
This constant is used as a placeholder for the actual 10-bit slave address that must be defined by the client code.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="13730.html">I2C Peripheral Library</a> &gt; <a href="17736.html">Using the Library</a> &gt; <a href="17718.html">How the Library Works</a> &gt; <a href="17727.html">Operating as a Master Transmitter</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB I2C Operating as a Master Transmitter Topic Title: Operating as a Master Transmitter)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>