<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Adding the Test Application to the Test List</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="16814.html">MPLAB Harmony Test Harness User's Guide</a> &gt; <a href="27031.html">Adding the Test Application to the Test List</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="27039.html">Previous</a> | <a href="16814.html">Up</a> | <a href="27030.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: TEST_HARNESS_UG Adding the Test Application to the Test List Topic Title: Adding the Test Application to the Test List)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Adding the Test Application to the Test List</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
In order for the Test Harness to initialize and run a test application (and the module it tests), it must be added to the test list. To add a test application to the test list, you must create and initialize specific members of the <a href="27026.html">TEST_DATA</a> structure that makes up that testâ€™s entry in the test list array, as shown in the following example.&nbsp;</p>
<p class="Element10">
<strong>Example: Array of Tests</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00177');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00177"><pre class="Element12"><i><span style="color: #008000">// *****************************************************************************</span></i>
<i><span style="color: #008000">/* Array of Tests

   This is an array of structures that provide data necessary for the harness to
   run a test.  It lists all tests that the harness will run
*/</span></i>

<strong><span style="color: #000080">static</span></strong> TEST_DATA tests[] =
{
    {
        .name       = &quot;USART Driver Functional&quot;,
        .initialize = TEST_DrvUsartFuncInitialize,
        .tasks      = TEST_DrvUsartFuncTasks,
        .start      = TEST_DrvUsartFuncStart,
        .index      = 0,
        .initData   = (SYS_MODULE_INIT *)&amp;testDrvUsartFuncInitData,
        .library    = &amp;testDrvUsartFuncData
    }
};</pre></div></div>
<p class="Element10">
The name member is a pointer to a string that contains the display name of the test, when debut output is supported. The initialize, tasks, and start members are pointers to the initialize, tasks, and start functions (respectively) of the test application. The index member identifies to which instance of the test application this test list entry refers. (For now, this is normally zero.) The <a href="13976.html">initData</a> member is a pointer to a structure that holds any initialization data required by the test application. In the sample test this structure is used to obtain pointers to the initialization data passed to the LUT. And finally, the library member is a pointer to a <a href="16304.html">LIBRARY_UNDER_TEST</a> structure (described below) that contains information about the LUT.&nbsp;</p>
<p class="Element10">
The <a href="16304.html">LIBRARY_UNDER_TEST</a> structure must be initialized to provide all the necessary information about the system interface of the library under test so that the harness can initialize and run the library, as shown in the following example.&nbsp;</p>
<p class="Element10">
<strong>Example: Initializing the Library Under Test</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00178');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00178"><pre class="Element12"><i><span style="color: #008000">/* USART Driver Module */</span></i>
LIBRARY_UNDER_TEST lutDriverUsart =
{
    .initialize         = DRV_USART_Initialize,
    .reinitialize       = NULL,
    .deinitialize       = DRV_USART_Deinitialize,
    .status             = DRV_USART_Status,
    .numberOfInstances  = 2,
    .numberOfTasks      = 3,
    .tasks              = {
                            DRV_USART_TasksTransmit,
                            DRV_USART_TasksReceive,
                            DRV_USART_TasksError
                          },
    .initData           = {
                            (SYS_MODULE_INIT *)&amp;drvUsart0InitData,
                            (SYS_MODULE_INIT *)&amp;drvUsart1InitData
                          }
};</pre></div></div>
<p class="Element10">
In the previous example, the LUT is the USART driver. It has initialize, deinitialize, and status functions as well as three tasks functions (<a href="11515.html">DRV_USART_TasksTransmit</a>, <a href="11514.html">DRV_USART_TasksReceive</a>, and <a href="11513.html">DRV_USART_TasksError</a>). Pointers to these functions are given as initialization values for the initialize, reinitialize, deinitialize, and tasks array members of this structure. The number of entries in the tasks array are configurable by defining the TEST_HARNESS_MAX_NUM_TASKS_PER_MODULE option and the number of tasks functions that must be called to support the LUT must be identified by initializing the numberOfTasks member, as shown above. Lastly, the number of instances of the LUT to be tested must be identified by initializing the numberOfInstances member and pointers to the initialization data of each instance (in order, starting from instance 0) must be given as initialization values of the <a href="13976.html">initData</a> array (also starting from entry 0 and going in order). The number of possible entries in the <a href="13976.html">initData</a> array is defined by the TEST_HARNESS_MAX_NUM_INSTANCES_PER_MODULE configuration option.&nbsp;</p>
<p class="Element10">
Finally, a pointer to the test list array is then passed into the initialization structure (<a href="27048.html">TEST_INIT_DATA</a>) of the Test Harness in the <span class="Element146">system_init.c</span> file to make all of this information available to the Test Harness, which then passes it to the test application and the LUT.&nbsp;</p>
<p class="Element10">
Once the test list and all associated data structures are initialized properly, the Test Harness can properly manage the test application and its associated module under test. To add additional test applications and LUTs, add additional entries to the test list and initialize them similarly. If you use the method shown in the Test Harness examples to calculate the size of the test list array the compiler will automatically calculate the number of entries in the array. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
The Test Harness assumes a one-to-one relationship between a test and a library under test. When testing a stack of related libraries it is best to test them one at a time, starting at the bottom of the stack and working up to higher-level libraries. If testing a desired library requires other libraries to be running, these libraries will need to run outside of the control of the Test Harness in exactly the way they are normally configured by the MHC.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="16814.html">MPLAB Harmony Test Harness User's Guide</a> &gt; <a href="27031.html">Adding the Test Application to the Test List</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: TEST_HARNESS_UG Adding the Test Application to the Test List Topic Title: Adding the Test Application to the Test List)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>