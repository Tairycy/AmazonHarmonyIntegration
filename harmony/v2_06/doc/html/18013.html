<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SPI Master Mode and Frame Master Mode</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="23143.html">SPI Peripheral Library</a> &gt; <a href="18024.html">Using the Library</a> &gt; <a href="18002.html">How the Library Works</a> &gt; <a href="17999.html">Framed SPI Modes</a> &gt; <a href="18013.html">SPI Master Mode and Frame Master Mode</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="17999.html">Previous</a> | <a href="17999.html">Up</a> | <a href="18014.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB SPI SPI Master Mode and Frame Master Mode Topic Title: SPI Master Mode and Frame Master Mode)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
SPI Master Mode and Frame Master Mode</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
In Master/Frame Master mode, the SPI module generates both the clock and frame synchronization signals, as shown in the following figure. </p><p class="Element10" style="text-align: center;">
<img src="Master_FrameMaster.png" border="0" alt="" title=""></p><p class="Element10">
In this mode, the serial clock is output continuously at the SCK pin, regardless of whether the module is transmitting. When the SPI buffer is written (<a href="20728.html">PLIB_SPI_BufferWrite</a>), the /SS pin will be driven to its active state on the appropriate transmit edge of the SCK clock, and remain active for one data frame. If the <a href="20787.html">PLIB_SPI_FrameSyncPulseEdgeSelect</a> function decides whether sync pulse precedes the data transmission or coincides with the beginning of the data transmission. The module starts transmitting data on the next transmit edge of the SCK.</p><div class="Element15">
Setup</div>
<p class="Element10">
The mode is enabled by calling <a href="20792.html">PLIB_SPI_MasterEnable</a>, <a href="20782.html">PLIB_SPI_FramedCommunicationEnable</a> and <a href="20786.html">PLIB_SPI_FrameSyncPulseDirectionSelect</a> (as output).&nbsp;</p>
<p class="Element10">
<strong>Example: SPI Master Mode and Frame Master Mode Communication</strong> <strong>Setup</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code03272');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code03272"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_SPI_ID            SPI_ID_1
<strong><span style="color: #000080">#define</span></strong> PERIPHERAL_BUS_CLK   80000000
<strong><span style="color: #000080">#define</span></strong> SPI_BAUD_RATE        10000000

<i><span style="color: #008000">//Disable SPI</span></i>
PLIB_SPI_Disable(MY_SPI_ID);

<i><span style="color: #008000">// Optional:  Clear SPI interrupts and status flag.</span></i>

<i><span style="color: #008000">//clear SPI buffer</span></i>
PLIB_SPI_BufferClear (MY_SPI_ID);

<i><span style="color: #008000">// Configure General SPI Options</span></i>
PLIB_SPI_StopInIdleDisable(MY_SPI_ID);
PLIB_SPI_PinEnable(MY_SPI_ID, SPI_PIN_SLAVE_SELECT|SPI_PIN_DATA_OUT);
PLIB_SPI_CommunicationWidthSelect(MY_SPI_ID, SPI_COMMUNICATION_WIDTH_16BITS);
PLIB_SPI_InputSamplePhaseSelect(MY_SPI_ID,SPI_INPUT_SAMPLING_PHASE_IN_MIDDLE);
PLIB_SPI_ClockPolaritySelect(MY_SPI_ID, SPI_CLOCK_POLARITY_IDLE_HIGH);
PLIB_SPI_OutputDataPhaseSelect(MY_SPI_ID, SPI_OUTPUT_DATA_PHASE_ON_ACTIVE_TO_IDLE_CLOCK);
PLIB_SPI_BaudRateSet(MY_SPI_ID,PERIPHERAL_BUS_CLK,SPI_BAUD_RATE);
PLIB_SPI_MasterEnable(MY_SPI_ID);

PLIB_SPI_FramedCommunicationEnable(MY_SPI_ID);
PLIB_SPI_FrameSyncPulseDirectionSelect(MY_SPI_ID, SPI_FRAME_PULSE_DIRECTION_INPUT);

<i><span style="color: #008000">// Optional:  Enable interrupts.</span></i>

<i><span style="color: #008000">// Enable the module</span></i>
PLIB_SPI_Enable(MY_SPI_ID);</pre></div></div>
<div class="Element15">
Transmission and Receive</div>
<p class="Element10">
Both data to be transmitted and data that is received are respectively written into, or read from, the SPI buffer.&nbsp;</p>
<p class="Element10">
<strong>Example: SPI Master Mode and Frame Master Mode Communication</strong> <strong>Transfer</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code03273');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code03273"><pre class="Element12"><strong><span style="color: #000080">#define</span></strong> MY_SPI_ID   SPI_ID_1

uint16_t data;

data = 0x00ac;

<i><span style="color: #008000">// write to buffer for TX</span></i>
PLIB_SPI_BufferWrite (MY_SPI_ID,data);

<i><span style="color: #008000">// Either Poll for Receiver buffer to be full using</span></i>
<i><span style="color: #008000">// PLIB_SPI_ReceiverBufferIsFull or wait for the interrupt</span></i>

<i><span style="color: #008000">// Read the received value</span></i>
data = PLIB_SPI_BufferRead (MY_SPI_ID);</pre></div></div>
<div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Notes:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">

<ol class="Element630">
<li value="1" class="Element600">Refer to the <strong>&quot;Interrupts&quot;</strong> chapter in the specific device data sheet or the family reference manual section specified in that chapter for details on how to clear and enable the SPI module interrupts and flags.</li>
<li value="2" class="Element600">MY_SPI_ID is the SPI instance selected for use by the application developer.</li>
<li value="3" class="Element600">Not all features are available on all devices. Refer to the <strong>&quot;Serial Peripheral Interface (SPI)&quot;</strong> chapter in the specific device data sheet for availability.</li>
</ol>&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="23143.html">SPI Peripheral Library</a> &gt; <a href="18024.html">Using the Library</a> &gt; <a href="18002.html">How the Library Works</a> &gt; <a href="17999.html">Framed SPI Modes</a> &gt; <a href="18013.html">SPI Master Mode and Frame Master Mode</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB SPI SPI Master Mode and Frame Master Mode Topic Title: SPI Master Mode and Frame Master Mode)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>