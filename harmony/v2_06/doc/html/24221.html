<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Changing the Clock</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="24419.html">System Service Libraries Help</a> &gt; <a href="17337.html">Clock System Service Library</a> &gt; <a href="24238.html">Using the Library</a> &gt; <a href="24226.html">How the Library Works</a> &gt; <a href="24221.html">Changing the Clock</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="24227.html">Previous</a> | <a href="24226.html">Up</a> | <a href="24237.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SYSTEM CLK Changing the Clock Topic Title: Changing the Clock)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Changing the Clock</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The module initializes only the system clock as part of the <a href="23513.html">SYS_CLK_Initialize</a> function. All other clocks including the peripheral clock must be set by calling specific functions.</p><div class="Element15">
Changing the System Clock</div>
<p class="Element10">
Changing the system clock is done using the <a href="23535.html">SYS_CLK_SystemFrequencySet</a> function, which expects the clock source and the frequency as arguments. If the clock source is a PLL-based source, a flag is provided so that a user can chose whether to wait until the operation is complete or just trigger the change and exit. The function will return zero if the requested clock is not achievable.</p><div class="Element15">
Changing the Peripheral Clock</div>
<p class="Element10">
Changing the Peripheral clock is done using the <a href="23515.html">SYS_CLK_PeripheralFrequencySet</a> function, which expects the clock source and the frequency as arguments. The function will return zero if the requested clock is not achievable. When this occurs, call the SYS_CLK_ PeripheralClosestFrequencyGet function by passing the bus number to it, to determine the closest possible clock.&nbsp;</p>
<p class="Element10">
switch ( clockState ) </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code03813');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code03813"><pre class="Element12">{
<strong><span style="color: #000080">case</span></strong> 1:
SYS_CLK_PeripheralFrequencySet ( CLK_BUS_PERIPHERAL_1, CLK_SOURCE_PERIPHERAL_SYSTEMCLK, 8000000, <strong><span style="color: #000080">true</span></strong> );

clockState++;

<strong><span style="color: #000080">break</span></strong>;

<strong><span style="color: #000080">case</span></strong> 2:
<strong><span style="color: #000080">if</span></strong> ( SYS_CLK_PeripheralOperationStatus ( CLK_BUS_PERIPHERAL_1 ) == SYS_CLK_OPERATION_COMPLETE )
{
<i><span style="color: #008000">//Peripheral clock setting is completed</span></i>
clockState++;
}
<strong><span style="color: #000080">break</span></strong>;
}</pre></div></div>
<div class="Element15">
Changing/Setting the Reference Clock</div>
<p class="Element10">
Changing or setting the reference clock is done using two functions. Set the module's response to Sleep and Idle mode using the function <a href="23519.html">SYS_CLK_ReferenceClockSetup</a>. Use the <a href="23521.html">SYS_CLK_ReferenceFrequencySet</a> function to set the clock out, which expects the clock source and the frequency as arguments. The function will return zero if the requested clock is not achievable. When this occurs, call the SYS_CLK_ ReferenceClosestFrequencyGet function by passing the bus number to it, to determine the closest possible clock. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code03814');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code03814"><pre class="Element12">uint32_t achievedFrequencyHz;

<i><span style="color: #008000">//I want 200 kHz as output</span></i>
achievedFrequencyHz = SYS_CLK_ReferenceFrequencySet ( CLK_BUS_REFERENCE_3, CLK_SOURCE_REF_FRC, 200000, <strong><span style="color: #000080">true</span></strong> );

<strong><span style="color: #000080">if</span></strong> ( achievedFrequencyHz != 0 )
{
         <i><span style="color: #008000">//Frequency successfully set</span></i>
}</pre></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="24419.html">System Service Libraries Help</a> &gt; <a href="17337.html">Clock System Service Library</a> &gt; <a href="24238.html">Using the Library</a> &gt; <a href="24226.html">How the Library Works</a> &gt; <a href="24221.html">Changing the Clock</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SYSTEM CLK Changing the Clock Topic Title: Changing the Clock)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>