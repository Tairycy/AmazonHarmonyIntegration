<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Example - Channel Scanning</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="02553.html">ADCHS Peripheral Library</a> &gt; <a href="17431.html">Using the Library</a> &gt; <a href="17423.html">How the Library Works</a> &gt; <a href="17407.html">Functionality</a> &gt; <a href="17414.html">Example - Channel Scanning</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="17418.html">Previous</a> | <a href="17407.html">Up</a> | <a href="17417.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB ADCHS Example - Channel Scanning Topic Title: Example - Channel Scanning)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Example - Channel Scanning</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
Channel scanning is used in applications where precise timing of the sample to an external source is not needed. Channel scanning allows a large number of analog inputs to be sampled and converted in sequence each time a single trigger occurs.&nbsp;</p>
<p class="Element10">
The following example illustrates how to configure channel scanning of multiple Class 2 and Class 3 inputs using Channel 7. This example uses inputs AN8, AN31 through AN33. AN8 is Class 2 inputs. AN31 to AN33 are Class 3 inputs. The global software trigger is used to initiate the scan. A 3 TAD7 sample time is specified for Channel 7, which is configured for single-ended operation and a unipolar output. No interrupts are used so the results are polled for ready status. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code01463');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code01463"><pre class="Element12">{
    <strong><span style="color: #000080">int</span></strong> result[4]; <i><span style="color: #008000">// storage for results</span></i>
    <i><span style="color: #008000">// Configure the ADC</span></i>
    PLIB_ADCHS_Setup
    (
        MY_ADCHS_INSTANCE,
        ADCHS_VREF_AVDD_AVSS,                     <i><span style="color: #008000">// AVDD and AVSS as reference</span></i>
        ADCHS_CHARGEPUMP_DISABLE,                 <i><span style="color: #008000">// No charge pump</span></i>
        ADCHS_OUTPUT_DATA_FORMAT_FRACTIONAL,      <i><span style="color: #008000">// Use fractional format</span></i>
        <strong><span style="color: #000080">true</span></strong>,                                     <i><span style="color: #008000">// Do stop in idle</span></i>
        ADCHS_FAST_SYNC_SYSTEM_CLOCK_ENABLE,      <i><span style="color: #008000">// Enable Fast synchronous system clock</span></i>
        ADCHS_FAST_SYNC_PERIPHERAL_CLOCK_DISABLE, <i><span style="color: #008000">// Disable Fast synchronous peripheral clock</span></i>
        ADCHS_INTERRUPT_BIT_SHIFT_LEFT_0_BITS,    <i><span style="color: #008000">// vector shift unused, interrupt not used</span></i>
        0,                                        <i><span style="color: #008000">// vector base address unused, interrupt not used</span></i>
        ADCHS_CLOCK_SOURCE_SYSCLK,                <i><span style="color: #008000">// SYSCLK is the clock source</span></i>
        1,                                        <i><span style="color: #008000">// TQ = 1/SYSCLK * 2</span></i>
        ADCHS_WARMUP_CLOCK_32                     <i><span style="color: #008000">// Warm-up time = 32 clocks</span></i>
    );
    <i><span style="color: #008000">// Configure the ADC SAR Channel-7</span></i>
    PLIB_ADCHS_ChannelSetup
    (
        MY_ADCHS_INSTANCE,
        ADCHS_CHANNEL_7,                          <i><span style="color: #008000">// Channel - 7</span></i>
        ADCHS_DATA_RESOLUTION_12BIT,              <i><span style="color: #008000">// resolution is set to 12bits</span></i>
        1,                                        <i><span style="color: #008000">// clock divider bit is, TAD7 = 2 * TQ</span></i>
        1,                                        <i><span style="color: #008000">// Sample time is 3 * TAD7</span></i>
        ADCHS_EARLY_INTERRUPT_PRIOR_CLOCK_1       <i><span style="color: #008000">// 1 clock early interrupt (ignored, interrupt not used)</span></i>
    );
    <i><span style="color: #008000">// Select analog channel AN8 and scan sequence to be triggered with global scan trigger</span></i>
    PLIB_ADCHS_AnalogInputScanSetup
    (
        MY_ADCHS_INSTANCE,
        ADCHS_AN8,
        ADCHS_SCAN_TRIGGER_SENSITIVE_EDGE,
        ADCHS_SCAN_TRIGGER_SOURCE_GLOBAL_SOFTWARE_EDGE
    );
    <i><span style="color: #008000">// Now, add further analog inputs, AN31, AN32, AN33 to scan list</span></i>
    PLIB_ADCHS_AnalogInputScanSelect(MY_ADCHS_INSTANCE, ADCHS_AN31);
    PLIB_ADCHS_AnalogInputScanSelect(MY_ADCHS_INSTANCE, ADCHS_AN32);
    PLIB_ADCHS_AnalogInputScanSelect(MY_ADCHS_INSTANCE, ADCHS_AN33);
    <i><span style="color: #008000">// Select input mode for AN8, AN31, AN32, AN33</span></i>
    PLIB_ADCHS_AnalogInputModeSelect
    (
        MY_ADCHS_INSTANCE,
        ADCHS_AN8,
        ADCHS_INPUT_MODE_SINGLE_ENDED_UNIPOLAR
    );
    PLIB_ADCHS_AnalogInputModeSelect
    (
        MY_ADCHS_INSTANCE,
        ADCHS_AN31,
        ADCHS_INPUT_MODE_SINGLE_ENDED_UNIPOLAR
    );
    PLIB_ADCHS_AnalogInputModeSelect
    (
        MY_ADCHS_INSTANCE,
        ADCHS_AN32,
        ADCHS_INPUT_MODE_SINGLE_ENDED_UNIPOLAR
    );
    PLIB_ADCHS_AnalogInputModeSelect
    (
        MY_ADCHS_INSTANCE,
        ADCHS_AN33,
        ADCHS_INPUT_MODE_SINGLE_ENDED_UNIPOLAR
    );
    <i><span style="color: #008000">// Select individual trigger for class-2 channels viz. AN8 to be scan trigger.</span></i>
    <i><span style="color: #008000">// AN31, AN32 and AN33 are class-3 channels, and do not have individual trigger</span></i>
    PLIB_ADCHS_AnalogInputTriggerSourceSelect
    (
        MY_ADCHS_INSTANCE,
        ADCHS_CLASS12_AN8,
        ADCHS_TRIGGER_SOURCE_SCAN
    );
    <i><span style="color: #008000">// Select AN8 to be edge trigger (not level trigger).</span></i>
    <i><span style="color: #008000">// Calling this function is needed for class-1 and 2 analog inputs</span></i>
    PLIB_ADCHS_AnalogInputEdgeTriggerSet( MY_ADCHS_INSTANCE, ADCHS_CLASS12_AN8);
    <i><span style="color: #008000">// Enable ADC</span></i>
    PLIB_ADCHS_Enable(MY_ADCHS_INSTANCE);
    <i><span style="color: #008000">// Check VREF to be ready</span></i>
    While(!PLIB_ADCHS_VREFIsReady(MY_ADCHS_INSTANCE));
    <i><span style="color: #008000">// Check for VREF Fault</span></i>
    While(PLIB_ADCHS_VREFFaultHasOccurred(MY_ADCHS_INSTANCE));
    <i><span style="color: #008000">// Enable analog circuit for channel-7</span></i>
    PLIB_ADCHS_ChannelAnalogFeatureEnable
    (
        MY_ADCHS_INSTANCE,
        ADCHS_CHANNEL_7
    );
    <i><span style="color: #008000">// Wait for the channel-7 to be ready</span></i>
    <strong><span style="color: #000080">while</span></strong>(!PLIB_ADCHS_ChannelIsReady
        (
            MY_ADCHS_INSTANCE,
            ADCHS_CHANNEL_7
        )
    );
    <i><span style="color: #008000">// Enable digital circuit for channels 7</span></i>
    PLIB_ADCHS_ChannelDigitalFeatureEnable
    (
        MY_ADCHS_INSTANCE,
        ADCHS_CHANNEL_7
    );
    <strong><span style="color: #000080">while</span></strong>(1)
    {
        <i><span style="color: #008000">// Enable global software trigger</span></i>
        PLIB_ADCHS_GlobalSoftwareTriggerEnable( MY_ADCHS_INSTANCE );
        <i><span style="color: #008000">// Wait for conversion complete for AN8</span></i>
        <strong><span style="color: #000080">while</span></strong>(!PLIB_ADCHS_AnalogInputDataIsReady(MY_ADCHS_INSTANCE, ADCHS_AN8));
        result[0] = PLIB_ADCHS_AnalogInputResultGet( MY_ADCHS_INSTANCE, ADCHS_AN8 );
        <i><span style="color: #008000">// Wait for conversion complete for AN31</span></i>
        <strong><span style="color: #000080">while</span></strong>(!PLIB_ADCHS_AnalogInputDataIsReady(MY_ADCHS_INSTANCE, ADCHS_AN31));
        result[1] = PLIB_ADCHS_AnalogInputResultGet( MY_ADCHS_INSTANCE, ADCHS_AN31 );
        <i><span style="color: #008000">// Wait for conversion complete for AN32</span></i>
        <strong><span style="color: #000080">while</span></strong>(!PLIB_ADCHS_AnalogInputDataIsReady(MY_ADCHS_INSTANCE, ADCHS_AN32));
        result[2] = PLIB_ADCHS_AnalogInputResultGet( MY_ADCHS_INSTANCE, ADCHS_AN32 );
        <i><span style="color: #008000">// Wait for conversion complete for AN33</span></i>
        <strong><span style="color: #000080">while</span></strong>(!PLIB_ADCHS_AnalogInputDataIsReady(MY_ADCHS_INSTANCE, ADCHS_AN33));
        result[3] = PLIB_ADCHS_AnalogInputResultGet( MY_ADCHS_INSTANCE, ADCHS_AN33 );
    }
    <strong><span style="color: #000080">return</span></strong>(1);
}</pre></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="17367.html">Peripheral Libraries Help</a> &gt; <a href="02553.html">ADCHS Peripheral Library</a> &gt; <a href="17431.html">Using the Library</a> &gt; <a href="17423.html">How the Library Works</a> &gt; <a href="17407.html">Functionality</a> &gt; <a href="17414.html">Example - Channel Scanning</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: PLIB ADCHS Example - Channel Scanning Topic Title: Example - Channel Scanning)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>