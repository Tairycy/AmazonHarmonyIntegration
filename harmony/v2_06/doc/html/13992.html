<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>How the Library Works</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="13069.html">Driver Libraries Help</a> &gt; <a href="13984.html">Input System Service Touch Driver Library</a> &gt; <a href="13985.html">Input System Service Touch ADC Driver Library</a> &gt; <a href="13992.html">How the Library Works</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="13991.html">Previous</a> | <a href="13985.html">Up</a> | <a href="13988.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: Input_sys_serve_lib_adc_works Topic Title: How the Library Works)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
How the Library Works</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The library provides interfaces to support:
<ul class="Element635">
<li class="Element605">System functions, which provide system module interfaces, device initialization, deinitialization, open, close, and status functions.</li>
<li class="Element605">Timer – rate at which to detect a new position</li>
</ul>&nbsp;</p>
<p class="Element10">
Of note are the following routine, which are found in:&nbsp;</p>
<p class="Element10">
<span class="Element146">&lt;project&gt;/firmware/src/system_config/&lt;target_config&gt;/driver/input/touch_adc/src/drv_touch_adc.c</span>:
<ul class="Element635">
<li class="Element605"><span class="Element146">DRV_TOUCH_ADC_Tasks()</span> - sends a move, release, or press event to SYS_Input Services. It is called from <span class="Element146">system_tasks.c</span>.</li>
<li class="Element605"><span class="Element146">DRV_TOUCH_ADC_PositionDetect()</span> – performs resistance measurements to determine x and y positions.</li>
<li class="Element605"><span class="Element146">DRV_TOUCH_ADC_TouchGetX()</span> – returns the x coordinate.</li>
<li class="Element605"><span class="Element146">DRV_TOUCH_ADC_TouchGetY()</span> – returns the y coordinate.</li>
<li class="Element605"><span class="Element146">DRV_TOUCH_ADCCoefficientSet()</span> – stores 4-translation calibrate coefficients</li>
</ul></p><div class="Element15">
Initializing the Driver</div>
<p class="Element10">
Before the Touch ADC Driver can be opened, it must be configured and initialized. MHGC automatically includes the needed #define constants and source code into the project’s <span class="Element146">system_init.c </span>file.&nbsp;</p>
<p class="Element10">
The driver initialization is configured through the <span class="Element146">DRV_TOUCH_ADC_INIT</span> data structure that is passed to the <span class="Element146">DRV_TOUCH_ADC_Initialize</span> function.</p><div class="Element15">
Opening the Driver</div>
<p class="Element10">
To use the Touch ADC Driver, the application must open the driver. This is done by calling the<span class="Element146"> DRV_TOUCH_ADC_Open</span> function. If successful, the <span class="Element146">DRV_TOUCH_ADC_Open</span> function will return a handle to the driver. This handle records the association between the client and the driver instance that was opened. The <span class="Element146">DRV_TOUCH_ADC_Open</span> function may return <span class="Element146"><a href="10089.html">DRV_HANDLE_INVALID</a></span> in the situation where the driver is not ready to be opened. When this occurs, the application can try opening the driver again. Note that the open function may return an invalid handle in other (error) cases as well. The following code shows an example of the driver being opened.&nbsp;</p>
<p class="Element10">
<span class="Element146"><a href="10088.html">DRV_HANDLE</a> handle;</span>&nbsp;</p>
<p class="Element10">
<span class="Element146">handle = DRV_TOUCH_ADC_Open( DRV_TOUCH_ADC_INDEX_0,DRV_IO_INTENT_EXCLUSIVE );</span>&nbsp;</p>
<p class="Element10">
<span class="Element146">if( <a href="10089.html">DRV_HANDLE_INVALID</a> == handle )</span>&nbsp;</p>
<p class="Element10">
<span class="Element146">{</span>&nbsp;</p>
<p class="Element10">
<span class="Element146"> // Unable</span>&nbsp;</p>
<p class="Element10">
<span class="Element146">}</span>&nbsp;</p>
<p class="Element10">
&nbsp;</p><div class="Element15">
Tasks Routine</div>
<p class="Element10">
This routine communicates with the System Input Service on the state of the current X and Y positions detected. The routine checks 4 different conditions:
<ol class="Element635">
<li value="1" class="Element605">Invalid position – does not send an event upstream.</li>
<li value="2" class="Element605">Same position – sends a still event to input system service</li>
<li value="3" class="Element605">Move position – sends a move event to input system service.</li>
<li value="4" class="Element605">Release condition – sends a release event to input system service</li>
<li value="5" class="Element605">Press condition- sends a press event to input system service.</li>
</ol></p><div class="Element15">
Touch Detection</div>
<p class="Element10">
This routine uses the services of the Touch ADC to establish a voltage divider on 4 ADC pins. The table below shows the pin configurations required to read the x and y values. The X value is read by a bias on x-axis and a measurement on ADC Y+ pin. The Y value is read by a bias on the y-axis and a measurement on ADC X+ pin. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="8%">
<div class="Element66">
Operation&nbsp;</div></td><td class="Element65" valign="top" width="26%">
<div class="Element66">
X+ Pin Action&nbsp;</div></td><td class="Element65" valign="top" width="26%">
<div class="Element66">
Y+Pin Action&nbsp;</div></td><td class="Element65" valign="top" width="20%">
<div class="Element66">
X-GPIO Pin State&nbsp;</div></td><td class="Element65" valign="top" width="20%">
<div class="Element66">
Y-GPIO Pin State&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="8%">
<div class="Element68">
Get X&nbsp;</div></td><td class="Element67" valign="top" width="26%">
<div class="Element68">
Pin Output<br>(set)&nbsp;</div></td><td class="Element67" valign="top" width="26%">
<div class="Element68">
Pin Input<br>(Read X value)&nbsp;</div></td><td class="Element67" valign="top" width="20%">
<div class="Element68">
Pin Input&nbsp;</div></td><td class="Element67" valign="top" width="20%">
<div class="Element68">
Pin Output<br>(clear)&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="8%">
<div class="Element68">
Get Y&nbsp;</div></td><td class="Element67" valign="top" width="26%">
<div class="Element68">
Pin Input<br>(read Y value)&nbsp;</div></td><td class="Element67" valign="top" width="26%">
<div class="Element68">
Pin Output<br>(set)&nbsp;</div></td><td class="Element67" valign="top" width="20%">
<div class="Element68">
Pin Output<br>(clear)&nbsp;</div></td><td class="Element67" valign="top" width="20%">
<div class="Element68">
Pin Input&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
(Here &quot;set&quot; means <a href="24078.html">SYS_PORTS_PinSet</a>() and &quot;clear&quot; means <a href="24067.html">SYS_PORTS_PinClear</a>().)</p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="13069.html">Driver Libraries Help</a> &gt; <a href="13984.html">Input System Service Touch Driver Library</a> &gt; <a href="13985.html">Input System Service Touch ADC Driver Library</a> &gt; <a href="13992.html">How the Library Works</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: Input_sys_serve_lib_adc_works Topic Title: How the Library Works)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>