<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Touch Integration</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="27074.html">Volume VI: Third-Party Products</a> &gt; <a href="22930.html">SEGGER emWin Graphics Library Help</a> &gt; <a href="22952.html">Using SEGGER emWin with MPLAB Harmony</a> &gt; <a href="22934.html">Integrating SEGGER emWin and MPLAB Harmony</a> &gt; <a href="22951.html">Touch Integration</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="22937.html">Previous</a> | <a href="22934.html">Up</a> | <a href="22945.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SEGGER EMWIN Touch Integration Topic Title: Touch Integration)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Touch Integration</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The SEGGER emWin widgets respond to the pointer input device (PID) event based on the area where the event occurs. If the area falls within the widget area, the widget will react by modifying the predefined or custom widget properties. For example, if the user touches the touch screen within the area of an on-screen button, the button will change its properties, such as color or image. To do this, the location of touch needs to be registered with the SEGGER emWin Graphics Library on the touch event. The MPLAB Harmony Touch System Service will send a message on the touch event. The message will contain the description of the event and the coordinates of touch input. The messages from the Touch System Service need to be decoded and passed to the SEGGER emWin Graphics Library. The implementation of decoding the touch message and registering the touch input with the SEGGER emWin Graphics Library is already provided in the SEGGER emWin Touch Wrapper Library. The following code example shows how the Touch Wrapper Library initializes the Messaging System Service by creating the mailbox, decodes the touch message from the Touch System Service, and registers the decoded touch input with the SEGGER emWin Graphics Library. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04499');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04499"><pre class="Element12"><i><span style="color: #008000">/* Initialize Message System Service by creating a Mail box */</span></i>
<strong><span style="color: #000080">void</span></strong> emWin_TouchMailBoxCreate( <strong><span style="color: #000080">void</span></strong> )
{
    emWinTouchData.hMsgType = SYS_MSG_TypeCreate ( emWinTouchData.iSysMsg,
                                                   TYPE_TOUCHSCREEN ,
                                                   0 );

    emWinTouchData.hMailbox = SYS_MSG_MailboxOpen( emWinTouchData.iSysMsg,
                      (SYS_MSG_RECEIVE_CALLBACK) &amp;_emWin_TouchMessageCallback );

    SYS_MSG_MailboxMsgAdd( emWinTouchData.hMailbox, emWinTouchData.hMsgType );

    <strong><span style="color: #000080">return</span></strong>;
}</pre></div></div>
<p class="Element10">
In the following code example, iSysMsg is the instance of the Messaging System Service selected in MHC. The _emWin_TouchMessageCallback function is a callback function that decodes the touch message and also registers the touch input using the GUI_TOUCH_StoreStateEx function. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04500');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04500"><pre class="Element12"><i><span style="color: #008000">/* Decode Touch Message and
   register the touch input with SEGGER emWin Library */</span></i>
<strong><span style="color: #000080">static</span></strong> <strong><span style="color: #000080">void</span></strong> _emWin_TouchMessageCallback( SYS_MSG_OBJECT *pMsg )
{
    GUI_PID_STATE * pidState = NULL;

    <strong><span style="color: #000080">if</span></strong>( NULL == pMsg )
    {
        <strong><span style="color: #000080">return</span></strong>;
    }

    <strong><span style="color: #000080">if</span></strong>( TYPE_TOUCHSCREEN != pMsg-&gt;nMessageTypeID )
    {
        <strong><span style="color: #000080">return</span></strong>;
    }

    pidState = &amp;emWinTouchData.pidState;

    <strong><span style="color: #000080">if</span></strong>( EVENT_INVALID == pMsg-&gt;param0 ||
        EVENT_MOVE    == pMsg-&gt;param0 )
    {
        <strong><span style="color: #000080">return</span></strong>;
    }

    <strong><span style="color: #000080">if</span></strong>( EVENT_PRESS      == pMsg-&gt;param0 ||
        EVENT_STILLPRESS == pMsg-&gt;param0 )
    {
        pidState-&gt;Pressed = 1;
    }
    <strong><span style="color: #000080">else</span></strong>
    {
        pidState-&gt;Pressed = 0;
    }

    pidState-&gt;Layer = 0;
    pidState-&gt;x     = pMsg-&gt;param1;
    pidState-&gt;y     = pMsg-&gt;param2;

    GUI_TOUCH_StoreStateEx( pidState );

    <strong><span style="color: #000080">return</span></strong>;
}</pre></div></div>
<p class="Element10">
For more information on configuring the driver using <span class="Element146">LCDConf.c</span>, please refer to the <i>&quot;emWin Graphic Library with Graphical User Interface User and Reference Guide&quot;</i>, document UM03001, which is available for download from the SEGGER website at: <a href="#" onclick="openExternalLink('https://www.segger.com/downloads/emwin');"><img src="indicator_external_link.gif" border="0" alt="" title="">https://www.segger.com/downloads/emwin</a>.</p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="27074.html">Volume VI: Third-Party Products</a> &gt; <a href="22930.html">SEGGER emWin Graphics Library Help</a> &gt; <a href="22952.html">Using SEGGER emWin with MPLAB Harmony</a> &gt; <a href="22934.html">Integrating SEGGER emWin and MPLAB Harmony</a> &gt; <a href="22951.html">Touch Integration</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SEGGER EMWIN Touch Integration Topic Title: Touch Integration)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>