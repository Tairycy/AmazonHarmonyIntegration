<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SEGGER emWin Event Handling</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="27074.html">Volume VI: Third-Party Products</a> &gt; <a href="22930.html">SEGGER emWin Graphics Library Help</a> &gt; <a href="22952.html">Using SEGGER emWin with MPLAB Harmony</a> &gt; <a href="22945.html">SEGGER emWin Event Handling</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="22951.html">Previous</a> | <a href="22952.html">Up</a> | <a href="22931.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SEGGER EMWIN SEGGER emWin Event Handling Topic Title: SEGGER emWin Event Handling)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
SEGGER emWin Event Handling</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
There are different ways in which an application may need to react to different events. Events can be internal events generated by the SEGGER emWin Graphics Library on touch input, or it can be an external event triggered by a button press from the demonstration hardware.</p><div class="Element15">
Event Handling Under Same Parent Widget</div>
<p class="Element10">
This is a common scenario of a GUI, where an event generated by one widget, changes the behavior of another widget from the same screen. Both widgets are under the common parent dialog widget. To do this, on the notification of event from one widget, get the handle of the other widget and use relevant APIs to modify the behavior of the other widget. For example, we will take into account a parent widget as the Framewin widget. There are two widgets under the Framewin widget: Spinbox and Slider. The following figure shows the example screen of this scenario. </p><p class="Element10" style="text-align: center;">
<img src="SEGGER EMWIN Same Parent Widget.png" border="0" alt="" title=""></p><p class="Element10">
After designing this GUI using GUIBuilder and saving it as C file, the generated C file needs to be edited to add the corresponding events. To change the value of the spin box by moving the slider, do the following:
<ol class="Element630">
<li value="1" class="Element600">Open the C file generated by GUIBuilder in MPLAB X IDE.</li>
<li value="2" class="Element600">Navigate to the _cbDialog function.</li>
<li value="3" class="Element600">Below the notification message for the slider, WM_NOTIFICATION _VALUE_CHANGED, add the following code:</li>
</ol></p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04501');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04501"><pre class="Element12"><i><span style="color: #008000">/* Get the handle of the Slider */</span></i>
hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_SLIDER_0);

<i><span style="color: #008000">/* Get the current value of the Slider */</span></i>
value = SLIDER_GetValue(hItem);

<i><span style="color: #008000">/* Get the handle of the Spinbox */</span></i>
hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_SPINBOX_0);

<i><span style="color: #008000">/* Set the spinbox value with slider value */</span></i>
SPINBOX_SetValue(hItem, value);</pre></div></div>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
The following code shows the updated dialog file. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04502');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04502"><pre class="Element12"><strong><span style="color: #000080">case</span></strong> ID_SLIDER_0: <i><span style="color: #008000">// Notifications sent by 'Slider'</span></i>
      <strong><span style="color: #000080">switch</span></strong>(NCode) {
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_CLICKED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
        <i><span style="color: #008000">// USER END</span></i>
        <strong><span style="color: #000080">break</span></strong>;
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_RELEASED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
        <i><span style="color: #008000">// USER END</span></i>
        <strong><span style="color: #000080">break</span></strong>;
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_VALUE_CHANGED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
            <i><span style="color: #008000">/* Get the handle of the Slider */</span></i>
            hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_SLIDER_0);

            <i><span style="color: #008000">/* Get the current value of the Slider */</span></i>
            value = SLIDER_GetValue(hItem);

            <i><span style="color: #008000">/* Get the handle of the Spinbox */</span></i>
            hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_SPINBOX_0);

            <i><span style="color: #008000">/* Set the spinbox value with slider value */</span></i>
            SPINBOX_SetValue(hItem, value);
        <i><span style="color: #008000">// USER END</span></i>
        <strong><span style="color: #000080">break</span></strong>;
      <i><span style="color: #008000">// USER START (Optionally insert additional code for further notification handling)</span></i>
      <i><span style="color: #008000">// USER END</span></i>
      }
      <strong><span style="color: #000080">break</span></strong>;</pre></div></div>
<div class="Element15">
Event Handling Under Different Parent Widgets</div>
<p class="Element10">
This scenario occurs when a widget under one parent widget changes behavior of a widget under another parent widget. The two parent widgets are referred to as P1 and P2. The child widgets under parent widgets P1 and P2, are referred to as C1 and C2, respectively. There are two possible cases based on whether parent widget P2 exists at the time of an event generated by C1:
<ul class="Element630">
<li class="Element600">A) P2 parent widget does not exists</li>
<li class="Element600">B) P2 parent widget exists</li>
</ul>For case A, the properties of child widget C2 need to be initialized based on the state of child widget C1. For case B, the properties of the child widget C2 can be changed on an event generated by child widget C1. The following section discusses both case A and case B in further detail.&nbsp;</p>
<p class="Element10">
<strong>Parent Widget P2 Does Not Exist</strong>&nbsp;</p>
<p class="Element10">
In this example, we have two parent widgets, Dialog1 widget and Dialog2 widget. The Dialog1 parent widget has two child widgets: a check box and a button. Similarly, the Dialog2 parent widget has two child widgets: text and a button. The following figures show examples of both dialogs: </p><p class="Element10" style="text-align: center;">
<img src="SEGGER EMWIN Different Parent Widget I.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
<img src="SEGGER EMWIN Different Parent Widget II.png" border="0" alt="" title="">&nbsp;</p><p class="Element10">
In this example, to navigate from Dialog1 to Dialog2 the Next button from Dialog1 must be pressed. Similarly, to navigate from Dialog2 to Dialog1 the Previous button from Dialog2 must be pressed. The example starts with Dialog1. Dialog2 will be created only after pressing the Next button in Dialog1. The goal of this example is to change the text from Dialog2 using the check box from Dialog1. By default, the check box from Dialog1 will be clear (i.e., not checked). If the check box remains clear and demonstration is navigated from Dialog1 to Dialog2, the text will have the value value “Disabled”. If the check box from Dialog1 is selected (i.e., checked), on navigating from Dialog1 to Dialog2, the text will have the value “Enabled”. To achieve these results, the text widget from Dialog2 needs to be initialized with a value based on the state of the check box widget from Dialog1. During initialization of the text widget from Dialog2, if the state of the check box widget from Dialog1 is selected, set the value of the text from Dialog2 as “Enabled”; otherwise, set it as “Disabled”. The following code example shows the Dialog2 file generated by GUIBuilder. The file is further edited to add custom initialization code for the text widget. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04503');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04503"><pre class="Element12">    <i><span style="color: #008000">//</span></i>
    <i><span style="color: #008000">// Initialization of 'Text_1'</span></i>
    <i><span style="color: #008000">//</span></i>
    hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_TEXT_0);
    TEXT_SetTextAlign(hItem, GUI_TA_HCENTER | GUI_TA_VCENTER);
    TEXT_SetTextColor(hItem, GUI_MAKE_COLOR(0x00000000));
    TEXT_SetFont(hItem, GUI_FONT_13B_1);
    <i><span style="color: #008000">// USER START (Optionally insert additional code for further widget initialization)</span></i>
    <i><span style="color: #008000">/*
    Get handle of checkbox widget from Dialog1
    using Dialog1 handle and checkbox widget id.
    */</span></i>
    hItem = WM_GetDialogItem(hDialog1, 0x802);
    <i><span style="color: #008000">/*
    If checkbox is checked set text value to &quot;Enabled&quot;
    */</span></i>
    <strong><span style="color: #000080">if</span></strong>(CHECKBOX_IsChecked(hItem))
    {
        hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_TEXT_0);
        TEXT_SetText(hItem, &quot;Enabled&quot;);
    }
    <i><span style="color: #008000">/*
    else set text value to &quot;Disabled&quot;
    */</span></i>
    <strong><span style="color: #000080">else</span></strong>
    {
        hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_TEXT_0);
        TEXT_SetText(hItem, &quot;Disabled&quot;);
    }
    <i><span style="color: #008000">// USER END</span></i></pre></div></div>
<p class="Element10">
&nbsp;</p>
<p class="Element10">
<strong>Parent widget P2 exists</strong>&nbsp;</p>
<p class="Element10">
To describe this scenario, we will continue to use the previous example of Dialog1 and Dialog2. In the previous example, we have seen initialization of the properties widget C2 based on an event generated by widget C1, while P2 was not in existence at the time C1 generated the event. Both widgets, C1 and C2, are from different parent widgets, P1 and P2, respectively. Once the demonstration navigates from Dialog1 to Dialog2 for the first time, both parent widgets, Dialog1 and Dialog2, will come into existence and will be persistent until the widgets are destroyed. In such a case, to change the property of widget C2 based on an event generated by widget C1, the code required to change the property of widget C2 needs to be added under the widget C1 event handling code. In the previous example, at first, the check box from Dialog1 was selected to change the text value from Dialog2. To demonstrate the scenario where P2 now exists, the demonstration must navigate back to Dialog1 using the “Previous” button from Dialog2, clear the checked check box from Dialog1, and navigate back to Dialog2 using the “Next” button from Dialog1.&nbsp;</p>
<p class="Element10">
The text value from Dialog2 will still be “Enabled”. Please note that both Dialog1 and Dialog2 were already created and persistent. Navigating from Dialog1 to Dialog2 will not reinitialize the widgets, as Dialog2 and its child widgets are persistent. To change the value of existing widget text from Dialog2, the TEXT_SetText function must be called under event handler code of the widget check box from Dialog1. Once the suitable code is added, the text from Dialog2 will follow the check box selection from Dialog1. Anytime the check box from Dialog1 is cleared, the text from Dialog2 will reflect the value as “Disabled”. If the check box is selected, the text will reflect the value as “Enabled”. The following code example shows the required code under check box event handler from Dialog1. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04504');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04504"><pre class="Element12"><strong><span style="color: #000080">case</span></strong> WM_NOTIFY_PARENT:
    Id    = WM_GetId(pMsg-&gt;hWinSrc);
    NCode = pMsg-&gt;Data.v;
    <strong><span style="color: #000080">switch</span></strong>(Id) {
    <strong><span style="color: #000080">case</span></strong> ID_CHECKBOX_0: <i><span style="color: #008000">// Notifications sent by 'Checkbox_1'</span></i>
      <strong><span style="color: #000080">switch</span></strong>(NCode) {
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_CLICKED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
        <i><span style="color: #008000">// USER END</span></i>
        <strong><span style="color: #000080">break</span></strong>;
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_RELEASED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
        <i><span style="color: #008000">// USER END</span></i>
        <strong><span style="color: #000080">break</span></strong>;
      <strong><span style="color: #000080">case</span></strong> WM_NOTIFICATION_VALUE_CHANGED:
        <i><span style="color: #008000">// USER START (Optionally insert code for reacting on notification message)</span></i>
          <i><span style="color: #008000">/*
          If the Dialog2 handle is valid
          change the properties text widget from Dialog2
          */</span></i>
          <strong><span style="color: #000080">if</span></strong>(hDialog2)
          {
              hItem = WM_GetDialogItem(pMsg-&gt;hWin, ID_CHECKBOX_0);
              <i><span style="color: #008000">/*
              If checkbox from Dialog1 is checked
              Set the text value from Dialog2 to Enabled
              */</span></i>
              <strong><span style="color: #000080">if</span></strong>(CHECKBOX_IsChecked(hItem))
              {
                  hItem = WM_GetDialogItem(hDialog2, 0x808);
                  TEXT_SetText(hItem, &quot;Enabled&quot;);
              }
              <i><span style="color: #008000">/*
              Otherwise set the text value from Dialog2 to Disabled
              */</span></i>
              <strong><span style="color: #000080">else</span></strong>
              {
                  hItem = WM_GetDialogItem(hDialog2, 0x808);
                  TEXT_SetText(hItem, &quot;Disabled&quot;);
              }
          }

        <i><span style="color: #008000">// USER END</span></i></pre></div></div>
<div class="Element15">
External Event Handling</div>
<p class="Element10">
This section describes the method of changing widget properties based on external events. External events can be a button press or an interrupt generated by a peripheral, etc. Based on the external event, properties of targeted widgets are changed. For example, consider a dialog widget as a parent widget with a progress bar as the child widget. The goal of the demonstration is to increment the progress bar value with a hardware button press. The following figure shows the demonstration screen. </p><p class="Element10" style="text-align: center;">
<img src="SEGGER EMWIN External Event.png" border="0" alt="" title=""></p><p class="Element10">
It can be observed that at the center of the screen a progress bar is drawn. To change the value of the progress bar on an external event, such as a hardware button press, use the PROGBAR_SetValue function. In this example. to detect the button press of a button from demonstration hardware, the MPLAB Harmony BSP function, <a href="05102.html">BSP_SwitchStateGet</a>, is used. The following code example shows usage of these functions. </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code04505');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code04505"><pre class="Element12"><strong><span style="color: #000080">static</span></strong> int32_t value = 0;

<i><span style="color: #008000">/*
  Verify if button is pressed and
  valid handle of Dialog containing progress bar is available
*/</span></i>
<strong><span style="color: #000080">if</span></strong>( BSP_SWITCH_STATE_PRESSED == BSP_SwitchStateGet( BSP_SWITCH_S1 ) &amp;&amp;
    hDialog)
{
    <i><span style="color: #008000">/*
      Get the handle of Progress bar
    */</span></i>
    hItem = WM_GetDialogItem( hDialog, 0x801 );
    <i><span style="color: #008000">/*
      Update the value of Progress bar
    */</span></i>
    PROGBAR_SetValue( hItem, value++);
}</pre></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="27074.html">Volume VI: Third-Party Products</a> &gt; <a href="22930.html">SEGGER emWin Graphics Library Help</a> &gt; <a href="22952.html">Using SEGGER emWin with MPLAB Harmony</a> &gt; <a href="22945.html">SEGGER emWin Event Handling</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: SEGGER EMWIN SEGGER emWin Event Handling Topic Title: SEGGER emWin Event Handling)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>