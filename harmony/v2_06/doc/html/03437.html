<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>usb_smart_speaker</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03437.html">usb_smart_speaker</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="03435.html">Previous</a> | <a href="03389.html">Up</a> | <a href="03438.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usb_smart_speaker Topic Title: usb_smart_speaker)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
usb_smart_speaker</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
In this demonstration application:</p>
<ol class="Element630">
<li value="1" class="Element600">Record and Playback audio streams are setup to a PC Through a PIC32 USB V1.1 peripheral audio device interface.</li>
<li value="2" class="Element600">The users voice is received using the Codec (AK4953) microphone interface, while the playback occurs through the Codec line out interface to an amplified loudspeaker.</li>
<li value="3" class="Element600">The echo of the playback is used to train a robust normalized Least Mean Squares (rnLMS) adaptive filter during playback, which is used to cancel that same acoustic echo when someone speaks into the microphone.</li>
</ol><p class="Element10">
The adaptive filter block diagram is shown below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO AEC_BlockDiagram.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<p class="Element10">
The rnLMS algorithm is used to adapt the coefficients of a 512 tap FIR filter running at an 8Khz sampling rate. This filter structure incorporates features of robust error scaling to mitigate divergence of the FIR filter coefficients, h<sub>k</sub>, once the filter has converged to a high quality solution of the echo path.&nbsp;</p>
<p class="Element10">
Audacity can be used for playback of one track, and concurrent recording to another track, to demonstrate echo cancellation and to measure performance of the echo canceller. During Single Talk (ST), when only playback is occurring, the residual echo can be measured along with low level approximately stationary background noise. The following measurements provide performance information of the AEC:</p>
<ol class="Element630">
<li value="1" class="Element600">ERL (Echo Return Loss): the ratio of the loudspeaker input to the power of the echo received.</li>
<li value="2" class="Element600">ERLE (Echo Return Loss Enhancement) measurement: the ratio of the echo residual to input echo.</li>
</ol><p class="Element10">
During Double Talk (DT), when near speech is occurring during playback, the ENR (Echo to Near Ratio) can be measured, i.e. the ratio of the power of the echo at the microphone relative to the power of the near speech. The ERLE will determine the ENR requirement for the residual echo to be at a level where the near speech is recognizable by a human or a computer.&nbsp;</p>
<p class="Element10">
&nbsp;</p><div class="Element15">
Architecture</div>
<p class="Element10">
The block diagram is given below: </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO usab_smart_speaker architecture block diagram.png" border="0" alt="" title=""></p><div class="Element15">
Demonstration features</div>

<ul class="Element630">
<li class="Element600">AK453 Codec driver</li>
<li class="Element600">Acoustic Echo Cancellation (AEC)</li>
<li class="Element600">Double Talk Detection (DTD)</li>
<li class="Element600">USB V1.1 Audio Device Library</li>
</ul></div>
</div>
<a name="546F70696373"></a><div class="Element14">
Topics</div>
<div class="Element11">
<div class="Element10">
<div class="Element212">
<div class="TableDiv">
<table cellspacing="0" class="Table1">
<tr>
<td class="Element200" valign="top" width="35%">
<div class="Element201">
Name&nbsp;</div></td><td class="Element204" valign="top" width="65%">
<div class="Element205">
Description&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03438.html">Building the Application</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section details where to find the project configurations for building the application.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03439.html">Configuring the Hardware</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section describes how to configure the supported hardware.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03420.html">Running the Demonstration</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section provides instructions on how to build and run the usb_smart_speaker demonstration.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03437.html">usb_smart_speaker</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO usb_smart_speaker Topic Title: usb_smart_speaker)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>