<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>sdcard_usb_audio</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03407.html">sdcard_usb_audio</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="03406.html">Previous</a> | <a href="03389.html">Up</a> | <a href="03408.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO sdcard_usb_audio Topic Title: sdcard_usb_audio)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
sdcard_usb_audio</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
This application demonstrates an audio player application by playing audio files stored on a SD card. This demonstration also acts as a USB speaker with audio data streaming from a personal computer to PIC32 device.&nbsp;</p>
<p class="Element10">
Full-Speed USB is used for communication between the host computer and PIC32 device. The application also provides a Graphical User Interface with touch screen support to access and randomly select media tracks, and also provides controls to increase or decrease volume and mute or unmute the audio output. Additionally, the demonstration provides an option to select the media source, either a SD card or USB. The application supports playing 48 kHz, 16-bit audio. </p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table0">
<tr>
<td class="Element67" valign="top" width="10%" style="border:none;">
<div class="Element68">
<img src="Note Icon.png" border="0" alt="" title=""> <strong>Note:</strong>&nbsp;</div></td><td class="Element67" valign="top" width="90%" style="border:none;">
<div class="Element68">
The Audio Player application only support playback of WAVE (<span class="Element146">.wav</span>) files.&nbsp;</div></td></tr></table></div></div>
<div class="Element15">
Architecture</div>
<p class="Element10">
The sdcard_usb_audio application uses Graphics Library to render graphics to the display. The graphics library draws the widgets and images into the internal frame buffer. This frame buffer is transferred to the LCD display panel by the Low Cost Controllerless (LCC) driver using the DMA. Touch input from the touch controller goes through the I2C port, and the Touch System Service acquires the touch input information from the Touch and I2C drivers. The Touch System Service sends touch events to the Graphics Library, which processes these events and updates the frame data accordingly.&nbsp;</p>
<p class="Element10">
The application plays WAV files from the SD Card. The SD Card driver uses the SPI driver to interact with the SD Card. The application uses the File System Service to read/write data on the SD Card. The audio data read from the SD card is decoded by passing it to the WAV decoder. The decoded output is saved in the output buffers 1 and 2 which are used in ping pong manner. The output buffers 1 and 2 are submitted to the Codec driver for playing. Similarly, the audio data read from the USB host is saved in ping pong buffers which are then submitted to the Codec driver for playing.&nbsp;</p>
<p class="Element10">
The Codec is configured for 16-bit data and 48 kHz sampling frequency. The Codec driver sends the audio data to the AK4953 Codec using the I2S driver which in turn uses DMA to transfer the audio data. The Codec driver uses the I2C driver to send commands to the AK4953 Codec. </p><p class="Element10" style="text-align: center;">
<img src="APPS AUDIO sdcard_usb_audio Architecture Diagram.png" border="0" alt="" title="">&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p>
<p class="Element10" style="text-align: center;">
&nbsp;</p><div class="Element15">
Demonstration Features</div>

<ul class="Element630">
<li class="Element600"><a href="03268.html">AK4953 Codec Driver</a></li>
<li class="Element600"><a href="22915.html">SD Card Driver</a></li>
<li class="Element600"><a href="27320.html">USB Device (Audio Class) Library</a></li>
<li class="Element600"><a href="16818.html">MTCH6301 Touch Driver Library</a></li>
<li class="Element600"><a href="12133.html">File System Service</a></li>
<li class="Element600">WAV Decoder</li>
<li class="Element600"><a href="23141.html">SPI Driver</a> used by SD Card Driver</li>
<li class="Element600"><a href="13740.html">I2S Driver</a> used by Codec Driver for audio data transfer</li>
<li class="Element600"><a href="13729.html">I2C Driver</a> used by Codec (for command transfer)</li>
<li class="Element600"><a href="07980.html">DMA System Service</a></li>
</ul><div class="Element15">
Tools Setup Differences</div>

<ul class="Element630">
<li class="Element600">The Master Clock Input (MCKI) to the Codec is provided by Reference Clock Generator Output1 (REFCLKO1) of PIC32. The value for REFCLKO1 is set by navigating to<i> MPLAB Harmony Configurator &gt; Clock Diagram</i> and selecting <strong>Auto Calculate</strong> under REFCLKO1. Here, select <strong>Target I2S Input Frequency</strong> and click <strong>Apply</strong>. The REFCLKO1 will be set to 256 times the sampling frequency or 48000 x 256 = 12288000 Hz.</li>
<li class="Element600">The output of the System PLL is set to 198 MHz to accurately generate the REFCLKO1, which is set to 48000 x 256 = 12288000 Hz. This is done by setting the System PLL in <i>MPLAB Harmony Configurator &gt; Clock Diagram</i>. Here, select <strong>Auto Calculate</strong> and set the “Desired System Frequency” to 198 MHz</li>
<li class="Element600">The REFCLKO1 signal is mapped to PIN 70 (RD15). This is done through the <i>MPLAB Harmony Configurator &gt; Pin Table</i>.</li>
<li class="Element600">The touch driver uses the PIC32's &quot;External Interrupt 1&quot; (INT1) signal for touch events. The &quot;External Interrupt 1&quot; signal is mapped to pin RE8 (Pin 23). This is done through the <i>MPLAB Harmony Configurator &gt; Pin Table</i>.</li>
<li class="Element600">The “Include Force Write I2C Function” is selected in <i>Harmony Framework Configuration &gt; Drivers &gt; I2C</i>. This will include an API that sends data to the slave even if the slave NACKs data. This is needed by the AK4953 CODEC since it NACKs I2C data during the initialization sequence.</li>
<li class="Element600">The heap size is set to 100000 bytes to ensure enough memory for dynamic allocations. This is done by setting the size in MHC through the following menu selection: <i>Device &amp; Project Configuration &gt; Project Configuration &gt; XC32 (Global Options) &gt; xc32-ld &gt; General</i>.</li>
</ul></div>
</div>
<a name="546F70696373"></a><div class="Element14">
Topics</div>
<div class="Element11">
<div class="Element10">
<div class="Element212">
<div class="TableDiv">
<table cellspacing="0" class="Table1">
<tr>
<td class="Element200" valign="top" width="35%">
<div class="Element201">
Name&nbsp;</div></td><td class="Element204" valign="top" width="65%">
<div class="Element205">
Description&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03408.html">Building the Application</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section identifies the MPLAB X IDE project name and location and lists and describes the available configurations for the demonstration.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03409.html">Configuring the Hardware</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section describes how to configure the supported hardware.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="03410.html">Running the Demonstration</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
This section demonstrates how to run the demonstration.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="04300.html">Volume I: Getting Started With MPLAB Harmony Libraries and Applications</a> &gt; <a href="03342.html">Applications Help</a> &gt; <a href="04317.html">Audio Demonstrations</a> &gt; <a href="03389.html">Demonstrations</a> &gt; <a href="03407.html">sdcard_usb_audio</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: APPS AUDIO sdcard_usb_audio Topic Title: sdcard_usb_audio)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>