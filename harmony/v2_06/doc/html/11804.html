<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>System Interface</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="16810.html">MPLAB Harmony Driver Development Guide</a> &gt; <a href="11804.html">System Interface</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="11805.html">Previous</a> | <a href="16810.html">Up</a> | <a href="11790.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRVDEVGUIDE System Interface Topic Title: System Interface)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
System Interface</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
In MPLAB Harmony, almost everything running in the system is considered a module. A module usually has an internal state machine that runs when the system runs. Exactly what it means to <i>run</i> in the system depends on the configuration that is selected. In the simplest polled bare metal configuration a MPLAB Harmony system runs modules in a single polled super loop, implemented in the main function, as shown in the following example.&nbsp;</p>
<p class="Element10">
<strong>The Main Function</strong> &nbsp;</p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00119');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00119"><pre class="Element12"><strong><span style="color: #000080">int</span></strong> main ( <strong><span style="color: #000080">void</span></strong> )
{
    SYS_Initialize(NULL);

    <strong><span style="color: #000080">while</span></strong>( <strong><span style="color: #000080">true</span></strong> )
    {
        SYS_Tasks();

    }

    <strong><span style="color: #000080">return</span></strong>(EXIT_FAILURE);
}</pre></div></div>
<p class="Element10">
The <a href="23925.html">SYS_Initialize</a> and <a href="24151.html">SYS_Tasks</a> functions are implemented in system configuration-specific files, normally generated by the MPLAB Harmony Configurator (MHC). The <a href="23925.html">SYS_Initialize</a> function calls the initialization functions of all modules in the system. The initialization function of a module must (at a minimum) initialize the state machine of that module so that its tasks function can be safely called. Then, the <a href="24151.html">SYS_Tasks</a> function calls the tasks functions of all modules in the system. This continues indefinitely, keeping all of the modules in the system running. Effectively, the main loop and the <a href="23925.html">SYS_Initialize</a> and <a href="24151.html">SYS_Tasks</a> functions implement a simple system kernel scheduler as a round-robin polled super loop.&nbsp;</p>
<p class="Element10">
The signatures of these functions are always consistent, using the same parameters and return values. Only the names change from module to module. This provides a consistent execution model for polled, interrupt-driven, and RTOS-based environments and supports the ability to implement system executives, power mangers, and test harnesses that initialize, deinitialize and maintain multiple modules.&nbsp;</p>
<p class="Element10">
In any module, the system interface should be thought of as conceptually separate from the application or client Interface (what is commonly referred to as the API), as shown in the following diagram. </p><p class="Element10" style="text-align: center;">
<img src="DRVDEVGUIDE System Interface Diagram.png" border="0" alt="" title=""></p><p class="Element10">
These two interfaces serve completely separate purposes. The system interface allows system kernel or scheduler to initialize and run the module (as described previously) and the client interface allows the application or other client module to interact with the driver or module. The system code does not normally interact with the client-level API of the module and the application or any other client should not call the system interface functions or have access to the object handle (explained in the following sections). Once the system has been initialized, client or application code can call the driver’s client interface functions (such as open, read, and write functions). The client interface is described in detail in the Client Interface section.&nbsp;</p>
<p class="Element10">
Once a driver module has been initialized, its state machine must be placed into its initial state and it can be considered ready to use. Although its internal state machine may have still several initial transitions to complete, its other system and client interface routines may be called.&nbsp;</p>
<p class="Element10">
The initial power state of the module can be defined by build-time configuration parameters or be dependent upon the hardware initialization data passed into the initialize operation. Driver modules can be initialized in a power-on, full running state or a power-off or low-power state and reinitialized later under system control to a power-on state when they are needed. Drivers may also be reinitialized to refresh the hardware state.&nbsp;</p>
<p class="Element10">
A driver can be deinitialized if it does not need to be used any longer, after which none of its other interface functions may be called without first calling the initialize function again. The initialize function must not be called more than once without first calling the deinitialize function. The reinitialize operation can be called any time the module is in a ready state.&nbsp;</p>
<p class="Element10">
A driver’s system interface consists of the following functions, where <span class="Element146">&lt;module&gt;</span> matches the module abbreviation for the driver or peripheral.&nbsp;</p>
<p class="Element10">
<strong>Driver’s System Interface Functions</strong> &nbsp;</p><div class="Element63">
<div class="TableDiv">
<table cellspacing="0" class="Table2">
<tr>
<td class="Element65" valign="top" width="42%">
<div class="Element66">
Function&nbsp;</div></td><td class="Element65" valign="top" width="58%">
<div class="Element66">
Description&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="42%">
<div class="Element68">
<span class="Element146">DRV_&lt;module&gt;_Initialize</span>&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Place the driver in its initial state.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="42%">
<div class="Element68">
<span class="Element146">DRV_&lt;module&gt;_Tasks</span>&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Manage the running state of the driver.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="42%">
<div class="Element68">
<span class="Element146">DRV_&lt;module&gt;_Reinitialize</span>&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Change a running driver’s initial parameters.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="42%">
<div class="Element68">
<span class="Element146">DRV_&lt;module&gt;_Deinitialize</span>&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Disable the driver and stop it from running.&nbsp;</div></td></tr><tr>
<td class="Element67" valign="top" width="42%">
<div class="Element68">
<span class="Element146">DRV_&lt;module&gt;_Status</span>&nbsp;</div></td><td class="Element67" valign="top" width="58%">
<div class="Element68">
Provide the current status of the driver&nbsp;</div></td></tr></table></div></div>
<p class="Element10">
A driver can have only one of each of these functions, except for the <span class="Element146">DRV_&lt;module&gt;_Tasks</span> function. It is possible for a driver to have multiple different tasks functions, each maintaining a different state machine within the driver. The naming format for device-driver system module routines adds the <span class="Element146">DRV_</span> prefix to identify that the function belongs to a device driver module and to be consistent with the driver’s other interface routines.&nbsp;</p>
<p class="Element10">
Full descriptions of the driver-module interface routines that implement these operations are provided in the following sections.</p></div>
</div>
<a name="546F70696373"></a><div class="Element14">
Topics</div>
<div class="Element11">
<div class="Element10">
<div class="Element212">
<div class="TableDiv">
<table cellspacing="0" class="Table1">
<tr>
<td class="Element200" valign="top" width="35%">
<div class="Element201">
Name&nbsp;</div></td><td class="Element204" valign="top" width="65%">
<div class="Element205">
Description&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="11790.html">Module Initialization</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
Describes the details of the module initialization function.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="11792.html">Module Tasks</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
Describes the details of the module &quot;Tasks&quot; function.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="11791.html">Module Status</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
Describes the details of the module &quot;Status&quot; function.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="11789.html">Module Deinitialize</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
Describes the details of the module &quot;Deinitialize&quot; function.&nbsp;</div></td></tr><tr>
<td class="Element202" valign="top" width="35%">
<div class="Element203">
<a href="16690.html">Module Reinitialize</a>&nbsp;</div></td><td class="Element206" valign="top" width="65%">
<div class="Element207">
Describes the details of the module &quot;Reinitialize&quot; function.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="16810.html">MPLAB Harmony Driver Development Guide</a> &gt; <a href="11804.html">System Interface</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRVDEVGUIDE System Interface Topic Title: System Interface)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>