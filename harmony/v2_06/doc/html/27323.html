<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Abstraction Model</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="27418.html">USB Libraries Help</a> &gt; <a href="27320.html">USB Device Library</a> &gt; <a href="27319.html">USB Device Layer Library</a> &gt; <a href="27348.html">Using the Library</a> &gt; <a href="27323.html">Abstraction Model</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="27348.html">Previous</a> | <a href="27348.html">Up</a> | <a href="27344.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: USB DEVLAYER Abstraction Model Topic Title: Abstraction Model)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
Abstraction Model</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
<span style="color: #000000">The block diagram shows USB Device Layer interaction with USB controller driver, function drivers, user application and the system.</span> </p><p class="Element10" style="text-align: center;">
<span style="color: #000000"><strong>USB Device Layer Software Abstraction Block Diagram</strong></span>&nbsp;</p>
<p class="Element10" style="text-align: center;">
<img src="usb_device_stack.png" border="0" alt="" title=""></p><p class="Element10">
<span style="color: #000000"><strong>System Interaction</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The system is responsible for initializing and deinitializing the device</span><span style="color: #FFFFFF">_</span><span style="color: #000000">layer. It is also responsible for calling the USB Device Layer task routine.</span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000"><strong>Function Driver Interaction</strong></span>&nbsp;</p>
<p class="Element10">
<span style="color: #000000">The USB Device Layer interacts with a function driver for following reasons:</span>
<ul class="Element630">
<li class="Element600"><span style="color: #000000">Initializes the function driver when device is configured by the Host. This can happen when the Host issues a set configuration request to the device. The device</span><span style="color: #FFFFFF">_</span><span style="color: #000000">layer initializes only those function drivers that are valid for the selected configuration.</span></li>
<li class="Element600"><span style="color: #000000">Deinitializes the function driver when the Host issues a bus reset or when device is detached from the host or when the Host unconfigures the device by setting configuration value to '0'.</span></li>
<li class="Element600">F<span style="color: #000000">unction driver and USB Controller Driver task routines are run by the device</span><span style="color: #FFFFFF">_</span><span style="color: #000000">layer. </span>This means that these task routines run at the same priority as a device<span style="color: #FFFFFF">_</span>layer task.</li>
<li class="Element600"><span style="color: #000000">Forwards class/interface specific setup requests from host to function drivers for processing. The function drivers can use device layer</span><span style="color: #FFFFFF">_</span><span style="color: #000000">APIs to read and write data to Endpoint 0.</span></li>
</ul><span style="color: #000000">All of these interactions are initiated by the device</span><span style="color: #FFFFFF">_</span><span style="color: #000000">layer, and therefore, it is required for a </span>function driver to register a set of standard APIs with the device<span style="color: #FFFFFF">_</span>layer for initializing/deinitializing the function driver, for handling control transfers and for running the task routines. Registering of these callback functions with the device<span style="color: #FFFFFF">_</span>layer is a compile time step and is done using the function driver registration table. Function driver registration is explained in subsequent sections.&nbsp;</p>
<p class="Element10">
<strong>User Application (Client) Interaction</strong>&nbsp;</p>
<p class="Element10">
User application clients can register a callback function with the device<span style="color: #FFFFFF">_</span>layer to get USB device events. Apart from device events, the clients can interact with USB device layer<span style="color: #FFFFFF">_</span>to determine other status such as USB speed and remote wake-up. The Device Layer will forward Control Transfers whose Recipient field is set to Other, to the application. The application must use the Device Layer Control Transfer Routines to complete the control transfer.</p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="16811.html">Volume V: MPLAB Harmony Framework Reference</a> &gt; <a href="27418.html">USB Libraries Help</a> &gt; <a href="27320.html">USB Device Library</a> &gt; <a href="27319.html">USB Device Layer Library</a> &gt; <a href="27348.html">Using the Library</a> &gt; <a href="27323.html">Abstraction Model</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: USB DEVLAYER Abstraction Model Topic Title: Abstraction Model)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>