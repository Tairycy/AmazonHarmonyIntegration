<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PIC32 Bluetooth Stack Library</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta name="save" content="history" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoad();" onmousedown="onBodyMouseDown();">
<div id="persistenceDiv" style="display:none; behavior:url(#default#userData);"></div>

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="06505.html">Prebuilt Libraries</a> &gt; <a href="06504.html">Supported Libraries</a> &gt; <a href="06502.html">PIC32 Bluetooth Stack Library</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="06499.html">Previous</a> | <a href="06504.html">Up</a> | <a href="06501.html">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: BUILD PIC32 Bluetooth SPP-only Stack Library Topic Title: PIC32 Bluetooth Stack Library)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table><div class="Element5">
PIC32 Bluetooth Stack Library</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<div class="Element58">
<a name="4465736372697074696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
The PIC32 Bluetooth Stack Library is provided only in binary form. It consists of a large number of routines that enable the interface of a PIC32 system to a Bluetooth radio via a Hardware Communication Interface (HCI) controller and a UART port. The communication is enabled by a Simple Secured Pairing (SSP) and data is transmitted through the Bluetooth Serial Port Profile (SPP).&nbsp;</p>
<p class="Element10">
The SPP-only library, <span class="Element146">lib_bluetooth_spp_only_&lt;version&gt;.a</span>, is located in the directory <span class="Element146">&lt;install-dir&gt;/bin/framework/bluetooth</span>. Support for audio is provided as well, as part of a premium package, in the library, <span class="Element146">lib_bluetooth_&lt;version&gt;.a</span>, which is located in <span class="Element146">&lt;install-dir&gt;/bin/framework/bluetooth/premium/audio</span>.&nbsp;</p>
<p class="Element10">
Premium Bluetooth Audio applications also need at least one audio decoder. The Bluetooth specification requires that every Bluetooth audio application support a Sub-Band Coding (SBC) decoder. Support for a SBC decoder is provided in the library, <span class="Element146">lib_sbc_decoder_&lt;version&gt;.a</span>, which is located in the same directory as the Premium Bluetooth Stack Library: <span class="Element146">&lt;install-dir&gt;/bin/framework/bluetooth/premium/audio</span>.&nbsp;</p>
<p class="Element10">
The library interface allows for an external header file to control the port via Service Discovery Protocol (SDP), so customized interfaces are possible through the API. All API functions are exposed in the header file group, which is located within the <span class="Element146">&lt;install-dir&gt;/framework/bluetooth/cdbt</span> folder of your MPLAB Harmony installation.</p><div class="Element15">
Assembly Language Issue</div>
<p class="Element10">
There is an assembly language issue in the SBC Decoder Library that misaligns the stack pointer. Contrary to the MIPS programming specification, this error is benign except when the application is built for a device with a hardware Floating Point Unit (FPU), such as the PIC32MZ EF family of devices. In this case, the sub-routine context-saving operations will produce an exception and stop the application. A work around exists for this issue, which involves disabling FPU context-saving for Interrupt Service Routines (ISRs).&nbsp;</p>
<p class="Element10">
The work around is to convert all ISRs from: </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00091');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00091"><pre class="Element12"><strong><span style="color: #000080">void</span></strong> __ISR(vector,ipl) MyInterruptHandler(<strong><span style="color: #000080">void</span></strong>)</pre></div></div>
<p class="Element10">
and change them to: </p><div class="Element170">
<a href="#" onclick="CopyElementToClipboard('code00092');">Copy Code</a></div>
<div class="Element13"><div class="Element12" id="code00092"><pre class="Element12"><strong><span style="color: #000080">void</span></strong> __attribute__((vector),interrupt(ipl),nomips16,no_fpu)) MyInterruptHandler(<strong><span style="color: #000080">void</span></strong>)</pre></div></div>
<p class="Element10">
where, <span class="Element146">vector</span> and <span class="Element146">ipl</span> are replaced with the actual interrupt vector and interrupt priority level.&nbsp;</p>
<p class="Element10">
So as long as no FPU operations occur in ISRs and the routines are called by ISRs, this work around will prevent the misaligned stack pointer from causing an exception. If FPU operations result from an ISR with no_fpu enabled, a general exception will result.</p></div>
</div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="13064.html">Volume IV: MPLAB Harmony Development</a> &gt; <a href="06505.html">Prebuilt Libraries</a> &gt; <a href="06504.html">Supported Libraries</a> &gt; <a href="06502.html">PIC32 Bluetooth Stack Library</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="100%">
<div class="Element3">
 MPLAB Harmony Help</div>
</td></tr><tr><td width="100%">
<div class="Element4">
<a href="contents.htm">Contents</a> | <a href="idx.html">Index</a> | <a href="04300.html">Home</a></div>
</td></tr><tr><td width="100%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: BUILD PIC32 Bluetooth SPP-only Stack Library Topic Title: PIC32 Bluetooth Stack Library)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>